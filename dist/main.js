(()=>{"use strict";var e,t={4766:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=void 0,t.shuffle=function(e){const t=e;for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}},4904:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AssertLessOrEqualThanError=t.AssertLessThanError=t.AssertGreaterOrEqualThanError=t.AssertGreaterThanError=t.AssertIntegerError=t.AssertError=t.assertLessOrEqualThan=t.assertLessThan=t.assertGreaterOrEqualThan=t.assertGreaterThan=t.assertInteger=void 0,t.assertInteger=function(e){if(!Number.isInteger(e))throw new r},t.assertGreaterThan=function(e,t){if(e<=t)throw new i},t.assertGreaterOrEqualThan=function(e,t){if(e<t)throw new s},t.assertLessThan=function(e,t){if(e>=t)throw new o},t.assertLessOrEqualThan=function(e,t){if(e>t)throw new a};class n extends Error{}t.AssertError=n;class r extends n{}t.AssertIntegerError=r;class i extends n{}t.AssertGreaterThanError=i;class s extends n{}t.AssertGreaterOrEqualThanError=s;class o extends n{}t.AssertLessThanError=o;class a extends n{}t.AssertLessOrEqualThanError=a},6469:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;const r=n(4904),i=n(5629);class s{constructor(e,t,n){this.red=e,this.green=t,this.blue=n,e>255?e=255:e<0&&(e=0),t>255?t=255:t<0&&(t=0),n>255?n=255:n<0&&(n=0),(0,r.assertLessOrEqualThan)(e,255),(0,r.assertLessOrEqualThan)(t,255),(0,r.assertLessOrEqualThan)(n,255);const i=e=>1===e.length?"0"+e:e;this.hex="#"+i(this.red.toString(16))+i(this.green.toString(16))+i(this.blue.toString(16))}getRed(){return this.red}getGreen(){return this.green}getBlue(){return this.blue}mix(e,t){return new s(Math.round(this.red*(1-t)+e.getRed()*t),Math.round(this.green*(1-t)+e.getGreen()*t),Math.round(this.blue*(1-t)+e.getBlue()*t))}toHexFormat(){return this.hex}equals(e){return this.blue===e.getBlue()&&this.red===e.getRed()&&this.green===e.getGreen()}toArray(){return[this.red,this.green,this.blue]}static random(){return new s((0,i.randomInt)(0,255),(0,i.randomInt)(0,255),(0,i.randomInt)(0,255))}static fromHex(e){return e.startsWith("#")&&(e=e.slice(1)),new s(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16))}}t.Color=s},5629:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomInt=void 0,t.randomInt=function(e,t){const n=t-e+1;return Math.floor(Math.random()*n)+e}},2629:(e,t,n)=>{const r=n(7294),i=n(745),s=n(9378),o=n(1997),a=n(9376),l=n(7698),c=(0,i.createRoot)(document.getElementById("root")),u=new a.Store;c.render(r.createElement(o.AppContext.Provider,{value:u},r.createElement(l.GlobalStyle,null),r.createElement(s.App,null)))},4861:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0,t.Connection=class{constructor(e,t,n){this.from=e,this.to=t,this.weight=n}getFrom(){return this.from}getTo(){return this.to}getWeight(){return this.weight}setWeight(e){this.weight=e}getOutput(){return this.from.getOutput()*this.weight}}},310:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IdFactory=void 0,t.IdFactory=class{constructor(){this.id=1}next(){return this.id++}}},1837:(e,t)=>{function n(e){return e.getOutput()}Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0,t.Layer=class{constructor(e,t){this.id=e,this.neurons=t}activate(e=null){if(null===e)for(let e of this.neurons)e.activate();else for(let t=0;t<e.length;t++)this.neurons[t].activate(e[t]);return this.neurons.map(n)}getNeurons(){return this.neurons}serialize(){return{id:this.id,neurons:this.neurons.map((e=>e.serialize()))}}}},6431:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Network=void 0;const r=n(1837),i=n(8187);class s{constructor(e,t,n){this.input=e,this.hidden=t,this.output=n}getInputLayer(){return this.input}getHiddenLayers(){return this.hidden}getOutputLayer(){return this.output}activate(e){this.input.activate(e);for(const e of this.hidden)e.activate();return this.output.activate()}serialize(){return{input:this.input.serialize(),hidden:this.hidden.map((e=>e.serialize())),output:this.output.serialize()}}static deserialize(e){const t={},n={},o=e=>e.map((e=>{const r=new i.Neuron(e.id);return t[e.id]=r,n[e.id]=e.connections,r})),a=new r.Layer(e.input.id,o(e.input.neurons)),l=e.hidden.map((e=>new r.Layer(e.id,o(e.neurons)))),c=new r.Layer(e.input.id,o(e.output.neurons));for(let e in t)for(let r of n[e])t[e].connect(t[r[0]],r[1]);return new s(a,l,c)}}t.Network=s},8187:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Neuron=void 0;const r=n(4861);t.Neuron=class{constructor(e){this.id=e,this.connections=[],this.output=0}getId(){return this.id}connect(e,t){this.connections.push(new r.Connection(e,this,t))}activate(e=null){if(null!==e)this.output=e;else{let e=0;for(let t of this.connections)e+=t.getOutput();this.output=1/(1+Math.pow(Math.E,-e))}return this.output}getOutput(){return this.output}serialize(){return{id:this.id,connections:this.connections.map((e=>[e.getFrom().getId(),e.getWeight()]))}}getConnections(){return this.connections}}},4356:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRNN=void 0;const r=n(310),i=n(1837),s=n(6431),o=n(8187);function a(e,t){for(let n of t)for(let t of e)n.connect(t,Math.random())}t.createRNN=function(e,t,n){const l=new r.IdFactory,c=new r.IdFactory,u=[],h=[],d=[];for(let t=0;t<e;t++)h.push(new o.Neuron(l.next()));const m=new i.Layer(c.next(),h);for(let e of t){const t=[];for(let n=0;n<e;n++)t.push(new o.Neuron(l.next()));u.push(new i.Layer(c.next(),t))}for(let e=0;e<n;e++)d.push(new o.Neuron(l.next()));const g=new i.Layer(c.next(),d);return function(e,t,n){let r=e;for(let e of t)a(r.getNeurons(),e.getNeurons()),r=e;a(r.getNeurons(),n.getNeurons())}(m,u,g),function(e){for(const t of e){const e=t.getNeurons();for(let t=0;t<e.length-1;t++)a([e[t]],[e[t+1]]),a([e[t+1]],[e[t]])}}(u),new s.Network(m,u,g)}},9408:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerRenderer=void 0;const r=n(9273);t.WorkerRenderer=class{constructor(){this.listeners={},this.lastId=0,this.worker=new r.default,this.worker.addEventListener("message",(e=>{this.listeners[e.data.id](e.data.data),delete this.listeners[e.data.id]}))}render(e,t,n,r,i,s,o,a){const l=++this.lastId;this.listeners[l]=e,this.worker.postMessage({id:l,width:t,height:n,offsetX:r,offsetY:i,scale:s,mode:o,data:{width:a.getWidth(),height:a.getHeight(),payload:a.getPayload(),array:a.getArray()}},[a.getArray().buffer])}terminate(){this.worker.terminate()}}},4040:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractCell=void 0,t.AbstractCell=class{update(e,t){}isStatic(){return!0}isEmpty(){return!1}getId(){return 0}}},4591:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellContext=void 0;const r=n(4282);class i extends Error{}t.CellContext=class{constructor(e,t,n,r){this.grid=e,this.x=t,this.y=n,this.factory=r}moveByOffest(e,t){try{const n=this.getCoordinatesbyOffset(e,t),r=this.grid.getCell(this.x,this.y);this.grid.getCell(n[0],n[1]).isEmpty()&&(this.grid.delete(this.x,this.y),this.grid.insert(n[0],n[1],r))}catch(e){}}deleteByOffset(e,t){const n=this.getCoordinatesbyOffset(e,t);this.grid.delete(n[0],n[1])}getByOffest(e,t){try{const n=this.getCoordinatesbyOffset(e,t);return this.grid.getCell(n[0],n[1])}catch(e){return this.factory.createWall()}}replace(e){this.grid.delete(this.x,this.y),this.grid.insert(this.x,this.y,e(this.factory))}getCoordinatesbyOffset(e,t){const n=this.grid.getLoopMode(),s=n===r.GridLoopType.TORUS||n===r.GridLoopType.HORIZONTAL,o=n===r.GridLoopType.TORUS||n===r.GridLoopType.VERTICAL,a=this.grid.getWidth(),l=this.grid.getHeight();let c=this.x+e,u=this.y+t;if(s)for(;c<0;)c+=a;else if(c<0||c>a-1)throw new i;if(o)for(;u<0;)u+=l;else if(u<0||u>l-1)throw new i;return[c%a,u%l]}}},4240:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellFactory=void 0;const r=n(7816),i=n(1165),s=n(347),o=n(4730),a=n(59),l=n(1890);t.CellFactory=class{constructor(){this.id=0}create(e){switch(e){case"wall":return this.createWall();case"empty":return this.createEmpty();case"organism":return this.createOrganism(i.Genome.createRandom(),255,(0,l.randomDirection)());case"organic":return this.createOrganic(255)}throw new Error}createWall(){return this.wall?this.wall:this.wall=new a.WallCell}createEmpty(){return this.empty?this.empty:this.empty=new r.EmptyCell}createOrganism(e,t,n){return new o.OrganismCell(++this.id,e,t,n)}createOrganic(e){return new s.OrganicCell(e)}}},7816:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyCell=void 0;const r=n(4040);class i extends r.AbstractCell{getType(){return"empty"}isEmpty(){return!0}serialize(){return{type:"empty"}}}t.EmptyCell=i},347:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrganicCell=void 0;const r=n(4040);class i extends r.AbstractCell{constructor(e){super(),this.energy=e}getEnergy(){return this.energy}getType(){return"organic"}serialize(){return{type:"organic",energy:this.energy}}}t.OrganicCell=i},4730:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrganismCell=void 0;const r=n(4040),i=n(1890),s=n(347),o=n(7048),a=n(4766);class l extends r.AbstractCell{constructor(e,t,n,r){super(),this.id=e,this.genome=t,this.energy=n,this.direction=r,this.lifetime=0,this.lastAction=null,this.energyFromPhotosynthesis=0,this.energyFromChemosynthesis=0,this.energyFromOrganic=0,this.energyBuffer=0,this.childrenCount=0,this.stepCount=0,this.attackCount=0}getId(){return this.id}getType(){return"organism"}getLifetime(){return this.lifetime}getEnergy(){return this.energy}getDirection(){return this.direction}getGenome(){return this.genome}update(e,t){if(this.energy<=0)return void(0===this.energyBuffer?e.replace((e=>e.createEmpty())):e.replace((e=>e.createOrganic(this.energyBuffer))));if(this.lifetime>=t.organismMaxLifetime)return void e.replace((e=>e.createOrganic(this.energy)));const n=(0,i.getOffset)(this.direction),r=e.getByOffest(n[0],n[1]),s=this.genome.getAction(this,r);s===o.OrganismAction.STEP?this.makeStep(e):s===o.OrganismAction.ROTATE_LEFT?this.rotateLeft():s===o.OrganismAction.ROTATE_RIGHT?this.rotateRight():s===o.OrganismAction.DIVIDE?this.divide(e):s===o.OrganismAction.ATTACK?this.attact(e):s===o.OrganismAction.EAT?this.eat(e):s===o.OrganismAction.PHOTOSYNTHESIS?this.photosynthesis(t.photosynthesisEnergy):s===o.OrganismAction.CHEMOSYNTHESIS&&this.chemosynthesis(t.chemosynthesisEnergy),this.lastAction=s,this.lifetime++}rotateLeft(){this.direction=(0,i.rotateLeft)(this.direction),this.changeEnergy(-1)}rotateRight(){this.direction=(0,i.rotateRight)(this.direction),this.changeEnergy(-1)}makeStep(e){const t=(0,i.getOffset)(this.direction);e.moveByOffest(t[0],t[1]),this.changeEnergy(-1),this.stepCount++}divide(e){this.changeEnergy(-5);for(const t of(0,a.shuffle)(Object.keys(i.Direction))){const n=(0,i.getOffset)(i.Direction[t]);if(e.getByOffest(n[0],n[1]).isEmpty())return e.moveByOffest(n[0],n[1]),this.changeEnergy(Math.floor(this.energy/-2)),void(this.energy>0&&(e.replace((e=>e.createOrganism(this.genome.clone(),this.energy,this.direction))),this.childrenCount++))}this.energy>50?e.replace((e=>e.createOrganism(this.genome.clone(),Math.floor(this.energy/2),(0,i.randomDirection)()))):this.energy=0}attact(e){const t=(0,i.getOffset)(this.direction),n=e.getByOffest(t[0],t[1]);n instanceof l&&n.kill(),this.attackCount++,this.changeEnergy(-1)}eat(e){const t=(0,i.getOffset)(this.direction),n=e.getByOffest(t[0],t[1]);n instanceof s.OrganicCell&&(e.deleteByOffset(t[0],t[1]),e.moveByOffest(t[0],t[1]),this.changeEnergy(n.getEnergy()),this.energyFromOrganic+=n.getEnergy()),this.changeEnergy(-1)}photosynthesis(e){this.energyFromPhotosynthesis+=e,this.changeEnergy(e)}chemosynthesis(e){this.energyFromChemosynthesis+=e,this.changeEnergy(e)}changeEnergy(e){this.energy+=e,this.energy>255?this.energy=255:this.energy<0&&(this.energy=0)}kill(){0!==this.energy&&(this.energyBuffer=this.energy,this.energy=0)}isStatic(){return!1}isSimilar(e){return this.genome.isSimilar(e.getGenome())}getColor(){return this.genome.getColor()}getEnergyFromOrganic(){return this.energyFromOrganic}getEnergyFromPhotosynthesis(){return this.energyFromPhotosynthesis}getEnergyFromChemosynthesis(){return this.energyFromChemosynthesis}getChildrenCount(){return this.childrenCount}getAttackCount(){return this.attackCount}getStepCount(){return this.stepCount}getLastAction(){return this.lastAction}serialize(){return{id:this.id,type:"organism",lifetime:this.lifetime,energy:this.energy,color:this.getColor().toHexFormat(),direction:this.direction.toString(),lastAction:this.lastAction,childrenCount:this.childrenCount,attackCount:this.attackCount,stepCount:this.stepCount}}}t.OrganismCell=l},7048:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomAction=t.OrganismAction=void 0;const r=n(5629);var i;!function(e){e.ROTATE_LEFT="ROTATE_LEFT",e.ROTATE_RIGHT="ROTATE_RIGHT",e.STEP="STEP",e.ATTACK="ATTACK",e.EAT="EAT",e.DIVIDE="DIVIDE",e.NOTHING="NOTHING",e.PHOTOSYNTHESIS="PHOTOSYNTHESIS",e.CHEMOSYNTHESIS="CHEMOSYNTHESIS"}(i=t.OrganismAction||(t.OrganismAction={})),t.randomAction=function(){const e=Object.keys(i);return i[e[(0,r.randomInt)(0,e.length-1)]]}},1890:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rotateRight=t.rotateLeft=t.randomDirection=t.getOffset=t.Direction=void 0;const r=n(5629);var i;!function(e){e.NORTH="NORTH",e.NORTH_EAST="NORTH_EAST",e.NORTH_WEST="NORTH_WEST",e.SOUTH="SOUTH",e.SOUTH_EAST="SOUTH_EAST",e.SOUTH_WEST="SOUTH_WEST",e.EAST="EAST",e.WEST="WEST"}(i=t.Direction||(t.Direction={})),t.getOffset=function(e){switch(e){case i.NORTH:return[0,-1];case i.NORTH_EAST:return[1,-1];case i.NORTH_WEST:return[-1,-1];case i.SOUTH:return[0,1];case i.SOUTH_EAST:return[1,1];case i.SOUTH_WEST:return[-1,1];case i.EAST:return[1,0];case i.WEST:return[-1,0]}},t.randomDirection=function(){return i[Object.keys(i)[(0,r.randomInt)(0,7)]]},t.rotateLeft=function(e){switch(e){case i.NORTH:return i.NORTH_WEST;case i.NORTH_EAST:return i.NORTH;case i.NORTH_WEST:return i.WEST;case i.SOUTH:return i.SOUTH_EAST;case i.SOUTH_EAST:return i.EAST;case i.SOUTH_WEST:return i.SOUTH;case i.EAST:return i.NORTH_EAST;case i.WEST:return i.SOUTH_WEST}},t.rotateRight=function(e){switch(e){case i.NORTH:return i.NORTH_EAST;case i.NORTH_EAST:return i.EAST;case i.NORTH_WEST:return i.NORTH;case i.SOUTH:return i.SOUTH_WEST;case i.SOUTH_EAST:return i.SOUTH;case i.SOUTH_WEST:return i.WEST;case i.EAST:return i.SOUTH_EAST;case i.WEST:return i.NORTH_WEST}}},1165:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Genome=void 0;const r=n(347),i=n(7048),s=n(4730),o=n(59),a=n(6431),l=n(4356),c=n(5629),u=n(6469);var h;!function(e){e.EMPTY="EMPTY",e.WALL="WALL",e.ORGANIC="ORGANIC",e.ORGANISM_SIMILAR="ORGANISM_SIMILAR",e.ORGANISM_OTHER="ORGANISM_OTHER"}(h||(h={}));class d{constructor(e,t){this.neuralNetwork=e,this.color=t}getAction(e,t){const n=e.getEnergy()>=60?1:0;let a;a=t instanceof o.WallCell?[1,0,0,0,0,n]:t instanceof r.OrganicCell?[0,1,0,0,0,n]:t instanceof s.OrganismCell?e.isSimilar(t)?[0,0,1,0,0,n]:[0,0,0,1,0,n]:[0,0,0,0,1,n];const l=this.neuralNetwork.activate(a),c=Math.max(...l);switch(l.indexOf(c)){case 0:return i.OrganismAction.STEP;case 1:return i.OrganismAction.PHOTOSYNTHESIS;case 2:return i.OrganismAction.CHEMOSYNTHESIS;case 3:return i.OrganismAction.EAT;case 4:return i.OrganismAction.ATTACK;case 5:return i.OrganismAction.NOTHING;case 6:return i.OrganismAction.ROTATE_RIGHT;case 7:return i.OrganismAction.ROTATE_LEFT;case 8:return i.OrganismAction.DIVIDE}return i.OrganismAction.NOTHING}isSimilar(e){const t=e.getColor();return Math.abs(t.getRed()-this.color.getRed())+Math.abs(t.getGreen()-this.color.getGreen())+Math.abs(t.getBlue()-this.color.getBlue())<30}getColor(){return this.color}clone(){if(20<=(0,c.randomInt)(0,100))return this;const e=a.Network.deserialize(this.neuralNetwork.serialize()),t=e.getHiddenLayers();t.push(e.getInputLayer(),e.getOutputLayer());const n=[];for(const e of t)n.push(...e.getNeurons());const r=[];for(const e of n)r.push(...e.getConnections());const i=r[(0,c.randomInt)(0,r.length-1)];i.setWeight(i.getWeight()+1*(Math.random()>.5?1:-1)*Math.random());const s=new u.Color(this.color.getRed()+(Math.random()>.5?1:-1)*(0,c.randomInt)(0,5),this.color.getGreen()+(Math.random()>.5?1:-1)*(0,c.randomInt)(0,5),this.color.getBlue()+(Math.random()>.5?1:-1)*(0,c.randomInt)(0,5));return new d(e,s)}static createRandom(){return new d((0,l.createRNN)(6,[9],9),u.Color.random())}}t.Genome=d},59:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WallCell=void 0;const r=n(4040);class i extends r.AbstractCell{getType(){return"wall"}serialize(){return{type:"wall"}}}t.WallCell=i},3170:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CommonSimulation=void 0;const i=n(4766),s=n(4240),o=n(1890),a=n(1165),l=n(8158),c=n(6567),u=n(2056),h=n(691);class d extends c.Simulation{constructor(e){super(e),e=this.options,this.cellFactory=new s.CellFactory,this.state=new h.State(e.width,e.height,e.loop,new u.SimulationParameters,this.cellFactory);const t=Math.ceil(e.width*e.height*e.population/100);this.spawnOrganisms(t,e.initialEnergy)}step(){return new Promise((e=>{this.state.next(),e(this.state.getStep())}))}getState(e){return new Promise((t=>{const n=l.Data.create(this.state,e);t({step:this.state.getStep(),buffer:n.getArray().buffer,payload:e})}))}setParameter(e,t){return r(this,void 0,void 0,(function*(){return this.state.getParameters()[e]=t,this.state.getParameters()[e]}))}getOrganismsCount(){return r(this,void 0,void 0,(function*(){return this.state.getOrganismsCount()}))}findCellById(e){return r(this,void 0,void 0,(function*(){const t=this.state.getGrid().find(e);return t?t.serialize():null}))}getCell(e,t){return r(this,void 0,void 0,(function*(){return this.state.getGrid().getCell(e,t).serialize()}))}replace(e,t){return r(this,void 0,void 0,(function*(){this.state.replace(e,t)}))}spawnOrganisms(e,t){const n=[],r=this.state.getGrid().toArray();for(let e=0;e<r.length;e++)for(let t=0;t<r[e].length;t++)r[e][t].isEmpty()&&n.push([e,t]);for(const[r,s]of(0,i.shuffle)(n).slice(0,e))this.state.getGrid().insert(r,s,this.cellFactory.createOrganism(a.Genome.createRandom(),t,(0,o.randomDirection)()))}}t.CommonSimulation=d},8158:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Data=void 0;const r=n(4730),i=n(7048),s={empty:0,organism:1,organic:2,wall:3},o={direction:1,energy:1,lifetime:1,genesis:3,supply:3,attack:1,step:1,children:1,action:1},a={NORTH:0,NORTH_EAST:1,NORTH_WEST:2,SOUTH:3,SOUTH_EAST:4,SOUTH_WEST:5,EAST:6,WEST:7},l={[i.OrganismAction.ROTATE_LEFT]:1,[i.OrganismAction.ROTATE_RIGHT]:2,[i.OrganismAction.STEP]:3,[i.OrganismAction.ATTACK]:4,[i.OrganismAction.EAT]:5,[i.OrganismAction.DIVIDE]:6,[i.OrganismAction.NOTHING]:7,[i.OrganismAction.PHOTOSYNTHESIS]:8,[i.OrganismAction.CHEMOSYNTHESIS]:9};class c{constructor(e,t,n,r){this.array=e,this.payload=t,this.width=n,this.height=r,this.itemLength=this.payload?o[this.payload]+1:1}static create(e,t){const n=e.getGrid(),i=n.getWidth(),u=n.getHeight(),h=t?o[t]:0,d=new Uint8Array(i*u*(h+1));let m=0;for(let e=0;e<i;e++)for(let i=0;i<u;i++){const o=n.getCell(e,i);if(d[m++]=s[o.getType()],o instanceof r.OrganismCell)switch(t){case"direction":d[m]=a[o.getDirection()];break;case"energy":d[m]=o.getEnergy();break;case"lifetime":d[m]=o.getLifetime();break;case"genesis":const e=o.getColor().toArray();d[m]=e[0],d[m+1]=e[1],d[m+2]=e[2];break;case"supply":const t=o.getEnergyFromOrganic(),n=o.getEnergyFromPhotosynthesis(),r=o.getEnergyFromChemosynthesis(),i=Math.max(t,n,r);0===i?(d[m]=255,d[m+1]=255,d[m+2]=255):(d[m]=Math.trunc(255*t/i),d[m+1]=Math.trunc(255*n/i),d[m+2]=Math.trunc(255*r/i));break;case"attack":d[m]=o.getAttackCount();break;case"step":d[m]=o.getStepCount();break;case"children":d[m]=o.getChildrenCount();break;case"action":const s=o.getLastAction();d[m]=null===s?0:l[s]}m+=h}return new c(d,t,i,u)}getArray(){return this.array}getPayload(){return this.payload}getWidth(){return this.width}getHeight(){return this.height}getItemLength(){return this.itemLength}}t.Data=c},1563:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createSimulation=void 0;const i=n(3170),s=n(4403);t.createSimulation=function(e){return r(this,void 0,void 0,(function*(){let t;return t=window.Worker?yield s.WorkerSimulation.create(e):new i.CommonSimulation(e),t}))}},8928:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Grid=void 0;const r=n(4904);t.Grid=class{constructor(e,t,n,i){this.width=e,this.height=t,this.loop=n,this.cellFactory=i,this.cells=[],this.cellIdMap={},(0,r.assertGreaterThan)(e,0),(0,r.assertGreaterThan)(t,0);for(let n=0;n<e;n++){this.cells[n]=[];for(let e=0;e<t;e++)this.cells[n][e]=i.createEmpty()}}insert(e,t,n){(0,r.assertLessThan)(e,this.width),(0,r.assertLessThan)(t,this.height),(0,r.assertGreaterOrEqualThan)(e,0),(0,r.assertGreaterOrEqualThan)(t,0),this.cells[e][t]=n,n.getId()&&(this.cellIdMap[n.getId()]=n)}delete(e,t){const n=this.cells[e][t];this.cells[e][t]=this.cellFactory.createEmpty(),delete this.cellIdMap[n.getId()]}getCell(e,t){return this.cells[e][t]}find(e){return this.cellIdMap[e]}getLoopMode(){return this.loop}getWidth(){return this.width}getHeight(){return this.height}toArray(){return this.cells.map((e=>e.slice()))}serialize(){return this.toArray().map((e=>e.map((e=>e.serialize()))))}}},2056:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationParameters=void 0,t.SimulationParameters=class{constructor(e={}){this.organismMaxLifetimeValue=100,this.photosynthesisEnergyValue=5,this.chemosynthesisEnergyValue=5,null!=e.photosynthesisEnergy&&(this.photosynthesisEnergy=e.photosynthesisEnergy),null!=e.chemosynthesisEnergy&&(this.chemosynthesisEnergy=e.chemosynthesisEnergy),null!=e.organismMaxLifetime&&(this.organismMaxLifetime=e.organismMaxLifetime)}set organismMaxLifetime(e){this.organismMaxLifetimeValue=this.converNumberValue(e,!0,1,255)}get organismMaxLifetime(){return this.organismMaxLifetimeValue}set photosynthesisEnergy(e){this.photosynthesisEnergyValue=this.converNumberValue(e,!1,0,255)}get photosynthesisEnergy(){return this.photosynthesisEnergyValue}set chemosynthesisEnergy(e){this.chemosynthesisEnergyValue=this.converNumberValue(e,!1,0,255)}get chemosynthesisEnergy(){return this.chemosynthesisEnergyValue}serialize(){return{photosynthesisEnergy:this.photosynthesisEnergy,chemosynthesisEnergy:this.chemosynthesisEnergy,organismMaxLifetime:this.organismMaxLifetime}}converNumberValue(e,t=!0,n=null,r=null){return t&&(e=Math.trunc(e)),null==n&&(e=Math.max(n,e)),null==r&&(e=Math.min(r,e)),e}}},6567:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Simulation=t.StepData=void 0,t.StepData=class{constructor(e,t,n){this.step=e,this.buffer=t,this.payload=n}},t.Simulation=class{constructor(e){this.options=e}terminate(){}getOptions(){return this.options}}},691:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const r=n(4591),i=n(8928);t.State=class{constructor(e,t,n,r,s){this.parameters=r,this.cellFactory=s,this.step=0,this.grid=new i.Grid(e,t,n,s)}next(){const e=this.grid.toArray();for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++){const i=e[t][n];i.isStatic()||i.update(new r.CellContext(this.grid,t,n,this.cellFactory),this.parameters)}this.step++}getGrid(){return this.grid}getStep(){return this.step}getParameters(){return this.parameters}getOrganismsCount(){let e=0;for(let t=0;t<this.grid.getWidth();t++)for(let n=0;n<this.grid.getHeight();n++)"organism"===this.grid.getCell(t,n).getType()&&e++;return e}replace(e,t){for(const[n,r]of e)this.getGrid().insert(n,r,this.cellFactory.create(t))}}},4282:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.GridLoopType=void 0,(n=t.GridLoopType||(t.GridLoopType={})).NONE="NONE",n.TORUS="TORUS",n.VERTICAL="VERTICAL",n.HORIZONTAL="HORIZONTAL"},4403:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerSimulation=void 0;const r=n(6567),i=n(8365);class s extends r.Simulation{constructor(e,t){super(e),this.lastRequestId=0,this.messageListeners={step:{},state:{},setParameter:{},getOrganismsCount:{},getCell:{},findCellById:{},replace:{}},this.worker=new i.default,this.worker.postMessage({type:"init",options:e}),this.worker.addEventListener("message",(e=>{switch(e.data.type){case"init":return t(this);case"step":return this.messageListeners.step[e.data.id](e.data.step),void delete this.messageListeners.step[e.data.id];case"state":return this.messageListeners.state[e.data.id](new r.StepData(e.data.step,e.data.buffer,e.data.payload)),void delete this.messageListeners.state[e.data.id];case"setParameter":return this.messageListeners.setParameter[e.data.id](e.data.value),void delete this.messageListeners.setParameter[e.data.id];case"getOrganismsCount":return this.messageListeners.getOrganismsCount[e.data.id](e.data.count),void delete this.messageListeners.getOrganismsCount[e.data.id];case"getCell":return this.messageListeners.getCell[e.data.id](e.data.cell),void delete this.messageListeners.getCell[e.data.id];case"findCellById":return this.messageListeners.findCellById[e.data.id](e.data.cell),void delete this.messageListeners.findCellById[e.data.id];case"replace":return this.messageListeners.replace[e.data.id](),void delete this.messageListeners.replace[e.data.id]}}))}static create(e){return new Promise((t=>{new s(e,(e=>t(e)))}))}terminate(){this.worker.terminate()}step(){return new Promise((e=>{const t=this.nextId();this.messageListeners.step[t]=e,this.worker.postMessage({id:t,type:"step"})}))}getState(e){return new Promise((t=>{const n=this.nextId();this.messageListeners.state[n]=t,this.worker.postMessage({id:n,type:"requestState",payload:e})}))}setParameter(e,t){return new Promise((n=>{const r=this.nextId();this.messageListeners.setParameter[r]=n,this.worker.postMessage({id:r,type:"setParameter",parameter:e,value:t})}))}getOrganismsCount(){return new Promise((e=>{const t=this.nextId();this.messageListeners.getOrganismsCount[t]=e,this.worker.postMessage({id:t,type:"getOrganismsCount"})}))}findCellById(e){return new Promise((t=>{const n=this.nextId();this.messageListeners.findCellById[n]=t,this.worker.postMessage({id:n,type:"findCellById",cellId:e})}))}getCell(e,t){return new Promise((n=>{const r=this.nextId();this.messageListeners.getCell[r]=n,this.worker.postMessage({id:r,type:"getCell",x:e,y:t})}))}replace(e,t){return new Promise((n=>{const r=this.nextId();this.messageListeners.replace[r]=n,this.worker.postMessage({id:r,type:"replace",coords:e,cellType:t})}))}nextId(){return this.lastRequestId++}}t.WorkerSimulation=s},9378:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const r=n(2766),i=n(7294),s=n(7294),o=n(8804),a=n(7244),l=n(1997),c=n(8042),u=n(711),h=n(23),d=o.default.div`
    height: 100vh;
    background: #000;
    display: flex;
    color: #fff;
`,m=(0,r.observer)((()=>{const e=(0,s.useContext)(l.AppContext),t=e.getSimulation();return t?i.createElement(a.Simulation,{simulation:t}):i.createElement(c.CreateSimulationForm,{options:(0,u.loadOptions)(),onCreate:t=>e.newSimulation(t)})}));t.App=(0,r.observer)((()=>i.createElement(o.ThemeProvider,{theme:h.THEME},i.createElement(d,null,i.createElement(m,null)))))},2120:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;const r=n(2766),i=n(7294),s=n(8804),o=n(23),a={primary:{backgroundColor:o.THEME.primary,boderColor:o.THEME.primary,textColor:o.THEME.color},success:{backgroundColor:o.THEME.success,boderColor:o.THEME.success,textColor:o.THEME.color},secondary:{backgroundColor:o.THEME.secondary,boderColor:o.THEME.secondary,textColor:o.THEME.color}},l=s.default.button`
    border: 1px solid;
    border-radius: 10px;
    cursor: pointer;
    padding: 10px 16px;
    ${({width:e})=>e&&`width: ${e};`}
    ${({apperance:e})=>{const t=a[e||"secondary"];return`border-color: ${t.boderColor};background-color: ${t.backgroundColor};color: ${t.textColor};`}}
`;t.Button=(0,r.observer)((e=>i.createElement(l,Object.assign({},e),e.children)))},1017:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0;const r=n(7294),i=n(8804).default.div`
    border-radius: 10px;
    background: ${e=>e.theme.background};
    padding: 15px;

    & + & {
        margin-top: 10px;
    }
`;t.Card=e=>r.createElement(i,Object.assign({},e),e.children)},8360:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrganismCell=void 0;const r=n(7294),i=n(2766),s=n(1997),o=n(7294),a=n(8804),l={ROTATE_LEFT:"Rotate left",ROTATE_RIGHT:"Rotate right",STEP:"Step",ATTACK:"Attack",EAT:"Eat",DIVIDE:"Divide",NOTHING:"Nothing",PHOTOSYNTHESIS:"Photosynthesis",CHEMOSYNTHESIS:"Chemosynthesis"},c=a.default.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
`,u=a.default.div`
    display: flex;
    flex-direction: column;
    height: 100%;
`,h=a.default.span`
    color: #ff0000;
`,d=a.default.span`
    color: #00ff00;
`,m=a.default.div`
    flex-grow: 1;
    overflow-y: auto;
`,g=a.default.div`
    width: 30px;
    height: 30px;
    border: 2px solid ${({color:e})=>e};
    background: ${({color:e})=>e};
    display: flex;
    border-radius: 2px;
    justify-content: ${({direction:e})=>["WEST","SOUTH_WEST","NORTH_WEST"].includes(e)?"flex-start":["EAST","SOUTH_EAST","NORTH_EAST"].includes(e)?"flex-end":"center"};
    align-items: ${({direction:e})=>["NORTH","NORTH_WEST","NORTH_EAST"].includes(e)?"flex-start":["SOUTH","SOUTH_EAST","SOUTH_EAST"].includes(e)?"flex-end":"center"};

    &:before {
        content: "";
        background: #fff;
        width: 33%;
        height: 33%;
        display: block;
        border-radius: 100%;
        border: 1px solid #000;
    }
`;t.OrganismCell=(0,i.observer)((({})=>{const e=(0,o.useContext)(s.SimulationContext).getSelectedCell(),t=e.getCell(),n=e.getHistory();if("organism"===t.type)return r.createElement(r.Fragment,null,r.createElement(u,null,r.createElement("div",null,r.createElement(c,null,r.createElement("span",null,r.createElement(g,{color:t.color,direction:t.direction})),e.isAlive()?r.createElement(d,null,"Alive"):r.createElement(h,null,"Dead")),r.createElement(c,null,r.createElement("span",null,"Energy"),r.createElement("span",null,t.energy)),r.createElement(c,null,r.createElement("span",null,"Lifetime"),r.createElement("span",null,t.lifetime))),n.length>0&&r.createElement(r.Fragment,null,r.createElement("h3",null,"Action history"),r.createElement(m,null,n.map(((e,t)=>r.createElement("div",{key:t},l[e])))))))}))},8005:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnselectedCell=void 0;const r=n(7294),i=n(2766);n(8804).default.div`
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
`,t.UnselectedCell=(0,i.observer)((({})=>r.createElement(r.Fragment,null,"Select a cell on the map")))},1752:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=t.ContextMenuItem=void 0;const r=n(7294),i=n(8804),s=i.default.div`
    display: flex;
    flex-direction: column;
    background: #202c3c;
    margin-top: 10px;
    border-radius: 5px;
    padding: 10px 15px;
    width: 250px;
    box-shadow: rgba(0, 0, 0, 0.56) 0px 22px 70px 4px;
`,o=i.default.div`
    width: 100%;
    background: transparent;
    color: #fff;
    border: none;
    padding: 5px 20px;
    text-align: left;
    display: flex;
    align-items: center;
    width: 100%;
    font-size: 14px;

    &:hover {
        background: rgba(0, 0, 0, .3);
    }
`;t.ContextMenuItem=e=>r.createElement(o,Object.assign({},e),e.children),t.ContextMenu=e=>r.createElement(s,Object.assign({},e),e.children)},8042:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreateSimulationForm=void 0;const r=n(7294),i=n(7294),s=n(4282),o=n(2120),a=n(1017),l=n(2197),c=n(3540),u=n(3229),h=n(9906),d=n(1139),m=[{label:"None",value:s.GridLoopType.NONE},{label:"Torus",value:s.GridLoopType.TORUS},{label:"Horizontal",value:s.GridLoopType.HORIZONTAL},{label:"Vertical",value:s.GridLoopType.VERTICAL}];t.CreateSimulationForm=({options:e,onCreate:t})=>{const[n,s]=(0,i.useState)(e.loop),[g,p]=(0,i.useState)(e.width),[f,y]=(0,i.useState)(e.height),[v,b]=(0,i.useState)(e.initialEnergy),[E,O]=(0,i.useState)(e.population);return r.createElement(l.Flex,{align:"center",justify:"center"},r.createElement(a.Card,null,r.createElement(c.FormRow,{label:"Grid width"},r.createElement(u.NumberInput,{min:0,onChange:e=>p(e),value:g})),r.createElement(c.FormRow,{label:"Grid height"},r.createElement(u.NumberInput,{min:0,onChange:e=>y(e),value:f})),r.createElement(c.FormRow,{label:"Loop"},r.createElement(d.Select,{onSelect:e=>s(e),options:m,value:n})),r.createElement(h.RangeRow,{label:"Population",postfix:"%",min:0,max:100,step:.1,onChange:e=>O(e),value:E}),r.createElement(h.RangeRow,{label:"Initial energy",min:0,max:100,step:1,onChange:e=>b(e),value:v}),r.createElement(o.Button,{apperance:"primary",width:"100%",onClick:()=>{t({loop:n,width:g,height:f,initialEnergy:v,population:E})}},"Create")))}},2197:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Flex=void 0;const r=n(7294),i=n(8804).default.div`
    display: flex;
    flex-direction: ${e=>e.direction||"row"};
    justify-content: ${e=>e.justify||"stretch"};
    align-items: ${e=>e.align||"stretch"};
    flex-wrap: ${e=>e.wrap||"nowrap"};
    width: 100%;
`;t.Flex=e=>r.createElement(i,Object.assign({},e),e.children)},3540:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FormRow=void 0;const r=n(7294),i=n(8804),s=i.default.div`
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
    justify-content: stretch;
`,o=i.default.label`
    margin-bottom: 5px;
    display: block;
    width: 100%;
    color: ${e=>e.theme.color};
`;t.FormRow=e=>r.createElement(s,null,e.label&&r.createElement(o,null,e.label),e.children)},3229:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NumberInput=void 0;const r=n(7294),i=n(8804),s=n(6767),o=n(98),a=n(7625),l=i.default.input`
    width: 100%;
    background: ${e=>e.theme.secondary};
    border: 2px solid ${e=>e.theme.secondary};
    padding: 10px 60px 10px 10px;
    border-radius: 10px;
    color: ${e=>e.theme.color};
`,c=i.default.button`
    width: 20px;
    height: 20px;
    background: ${e=>e.theme.secondary};
    border: 2px solid ${e=>e.theme.secondary};
    border-radius: 100%;
    color: ${e=>e.theme.color};
    padding: 0;
    font-size: 14px;
    line-height: 1;
    margin-left: 5px;
`,u=(0,i.default)(c)`
    opacity: 0.5;
    cursor: default;
`,h=i.default.div`
    position: relative;
`,d=i.default.div`
    position: absolute;
    top: 11px;
    right: 10px;
`;t.NumberInput=e=>{const[t,n]=r.useState(e.value||0),i=t=>{void 0!==e.min&&t<e.min&&(t=e.min),void 0!==e.max&&t>e.max&&(t=e.max),n(t),e.onChange(t)};let m=r.createElement(c,{onClick:()=>i(t-1)},r.createElement(a.FontAwesomeIcon,{icon:s.faMinus})),g=r.createElement(c,{onClick:()=>i(t+1)},r.createElement(a.FontAwesomeIcon,{icon:o.faPlus}));return void 0!==e.min&&e.value<=e.min&&(m=r.createElement(u,null,r.createElement(a.FontAwesomeIcon,{icon:s.faMinus}))),void 0!==e.max&&e.value>=e.max&&(g=r.createElement(u,null,r.createElement(a.FontAwesomeIcon,{icon:o.faPlus}))),r.createElement(h,null,r.createElement(l,{type:"text",value:t,onChange:e=>(e=>{const t=Number(e);i(Number.isSafeInteger(t)?t:0)})(e.target.value)}),r.createElement(d,null,m,g))}},1522:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RadioGroup=void 0;const r=n(8055),i=n(7625),s=n(7294),o=n(8804),a=o.default.div`
    
`,l=o.default.div`
    display: flex;
    padding: 3px 0;
`,c=o.default.div`
    width: 20px;
`;t.RadioGroup=({choices:e,value:t,onChange:n})=>s.createElement(a,null,e.map(((e,o)=>s.createElement(l,{key:o,onClick:()=>n(e.value)},s.createElement(c,null,t===e.value&&s.createElement(i.FontAwesomeIcon,{icon:r.faCheck})),e.label))))},8863:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RangeInput=void 0;const r=n(7294),i=n(8804).default.input`
    width: 100%;
    -webkit-appearance: none;
    background: transparent;
    height: 12px;
    display: block;

    &::-webkit-slider-thumb {
        -webkit-appearance: none;
        background: #fff;
        height: 12px;
        width: 12px;
        border-radius: 50%;
        margin-top: -5px;
    }

    &::-moz-range-thumb {
        height: 12px;
        width: 12px;
        border-radius: 50%;
        background: #fff;
        border: none;
    }

    &::-webkit-slider-runnable-track  {
        -webkit-appearance: none;
        height: 2px;
        background: #fff;
        width: 100%;
    }

    &::-moz-range-track {
        width: 100%;
        height: 2px;
        background: #fff;
    }
`;t.RangeInput=e=>r.createElement(i,{type:"range",min:e.min,max:e.max,step:e.step,value:e.value,onChange:t=>e.onChange(Number(t.target.value))})},9906:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RangeRow=void 0;const r=n(7294),i=n(8804),s=n(2197),o=n(3540),a=n(8863),l=i.default.div`
    font-size: 12px;
    line-height: 1;
    text-align: right;
    min-width: 40px;
    margin-left: 5px;
    font-weight: bold;
`,c=i.default.div`
    flex-grow: 1;
`;t.RangeRow=({label:e,postfix:t,min:n,max:i,step:u,value:h,onChange:d})=>r.createElement(o.FormRow,{label:e},r.createElement(s.Flex,{align:"center"},r.createElement(c,null,r.createElement(a.RangeInput,{min:n,max:i,step:u,onChange:d,value:h})),r.createElement(l,null,h,t)))},1139:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;const r=n(7294),i=n(8804).default.select`
    background: ${e=>e.theme.secondary};
    border: 1px solid ${e=>e.theme.secondary};
    padding: 10px 10px;
    border-radius: 10px;
    color: ${e=>e.theme.color};
`;t.Select=e=>r.createElement(i,{onChange:t=>e.onSelect(t.target.value),value:e.value},e.options.map((({value:e,label:t},n)=>r.createElement("option",{value:e,key:n},t))))},4485:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Info=void 0;const r=n(7294),i=n(2766),s=n(1997),o=n(7294),a=n(8804).default.div`
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
`;t.Info=(0,i.observer)((({})=>{const e=(0,o.useContext)(s.SimulationContext);return r.createElement(r.Fragment,null,r.createElement(a,null,r.createElement("span",null,"Size"),r.createElement("span",null,e.getWidth(),"×",e.getHeight())),r.createElement(a,null,r.createElement("span",null,"Step"),r.createElement("span",null,e.getCurrentStep())),r.createElement(a,null,r.createElement("span",null,"Step time"),r.createElement("span",null,e.getStepTime()," ms")),r.createElement(a,null,r.createElement("span",null,"Render time"),r.createElement("span",null,e.getRenderer().getRenderTime()," ms")),r.createElement(a,null,r.createElement("span",null,"Organisms count"),r.createElement("span",null,e.getOrganismsCount())))}))},5912:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Overflow=void 0;const r=n(7294),i=n(7294),s=n(8804).default.div`
    position: fixed;
`;t.Overflow=({root:e,children:t,onLoseFocus:n})=>{const[o,a]=(0,i.useState)(0),[l,c]=(0,i.useState)(0),[u,h]=(0,i.useState)(!1),d=(0,i.useRef)();return(0,i.useEffect)((()=>{if(e&&d.current){const t=e.getBoundingClientRect();c(t.top+t.height),t.left+d.current.getBoundingClientRect().width>window.innerWidth?a(Math.max(0,window.innerWidth-d.current.getBoundingClientRect().width)):a(Math.max(0,t.left)),h(!0)}const t=t=>{e.contains(t.target)||n&&n()};return window.addEventListener("mousedown",t),()=>{window.removeEventListener("mousedown",t)}})),r.createElement(s,{style:{left:o,top:l,display:u?null:"none"},ref:d},t)}},6852:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Overlay=void 0;const r=n(7294),i=n(2766),s=n(8804),o=n(1936),a=n(7294),l=n(1997),c=n(4485),u=n(8477),h=s.default.div`
    position: absolute;
    top: 50px;
    left: 0;
    bottom: 0;
    pointer-events: none;
    width: 100%;
`,d=s.default.div`
    border-radius: 6px;
    background: rgba(16, 22, 30, 0.9);
    padding: 16px;
    width: 240px;
    position: absolute;
    top: 10px;
    right: 10px;
    pointer-events: all;
    max-height: 100%;
    overflow-y: auto;
`,m=s.default.div`
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    overflow-y: auto;
    pointer-events: all;
    padding: 16px;
    background: rgb(29, 37, 49);
    width: 320px;
`;t.Overlay=(0,i.observer)((({})=>{const e=(0,a.useContext)(l.SimulationContext).getUI();return r.createElement(h,null,e.isInfoOpened()&&r.createElement(d,null,r.createElement(c.Info,null)),e.isTabActive("parameters")&&r.createElement(m,null,r.createElement(o.Parameters,null)),e.isTabActive("cell")&&r.createElement(m,null,r.createElement(u.SelectedCell,null)))}))},1936:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0;const r=n(7294),i=n(2766),s=n(1997),o=n(7294),a=n(9906);t.Parameters=(0,i.observer)((({})=>{const e=(0,o.useContext)(s.SimulationContext).getParameters();return r.createElement(r.Fragment,null,r.createElement(a.RangeRow,{label:"Lifetime limit",min:1,max:255,step:1,onChange:t=>e.setOrganismMaxLifetime(t),value:e.getOrganismMaxLifetime()}),r.createElement(a.RangeRow,{label:"Photosynthesis energy",min:0,max:255,step:1,onChange:t=>e.setPhotosynthesisEnergy(t),value:e.getPhotosynthesisEnergy()}),r.createElement(a.RangeRow,{label:"Chemosynthesis energy",min:0,max:255,step:1,onChange:t=>e.setChemosynthesisEnergy(t),value:e.getChemosynthesisEnergy()}))}))},8477:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedCell=void 0;const r=n(7294),i=n(2766),s=n(1997),o=n(7294),a=n(8360),l=n(8005);t.SelectedCell=(0,i.observer)((({})=>{const e=(0,o.useContext)(s.SimulationContext).getSelectedCell().getCell();return e&&"organism"===e.type?r.createElement(a.OrganismCell,null):r.createElement(l.UnselectedCell,null)}))},7244:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Simulation=void 0;const r=n(7294),i=n(8804),s=n(2766),o=n(4924),a=n(6852),l=n(7999),c=n(1997),u=i.default.div`
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
`;t.Simulation=(0,s.observer)((({simulation:e})=>r.createElement(c.SimulationContext.Provider,{value:e},e.isReady()&&r.createElement(u,null,r.createElement(l.Toolbar,null),r.createElement(a.Overlay,null),r.createElement(o.Viewport,null)))))},7999:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Toolbar=void 0;const r=n(7294),i=n(8804),s=n(2766),o=n(6700),a=n(9008),l=n(2384),c=n(7099),u=n(7382),h=n(2742),d=n(9073),m=n(9697),g=i.default.div`
    display: flex;
    align-items: stretch;
    width: 100%;
    overflow-x: auto;
    background: ${e=>e.theme.background};
    height: 50px;
    position: relative;
    z-index: 1;
    user-select: none;
    box-shadow: 0 0 14px 0 #00000066;
`,p=i.default.div`
    display: flex;
    align-items: stretch;
    height: 100%;
    z-index: 1;
    flex-grow: 1;
    justify-content: ${e=>e.justify};
`;t.Toolbar=(0,s.observer)((({})=>r.createElement(g,null,r.createElement(p,{justify:"flex-start"},r.createElement(h.ParametersItem,null),r.createElement(m.CellItem,null)),r.createElement(p,{justify:"center"},r.createElement(o.StartPauseItem,null),r.createElement(a.StepItem,null),r.createElement(c.NewSimulationItem,null)),r.createElement(p,{justify:"flex-end"},r.createElement(l.RenderModeItem,null),r.createElement(u.PaintModeItem,null),r.createElement(d.InfoItem,null)))))},9697:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellItem=void 0;const r=n(7294),i=n(2766),s=n(7294),o=n(2922),a=n(7625),l=n(1997),c=n(8421);t.CellItem=(0,i.observer)((({})=>{const e=(0,s.useContext)(l.SimulationContext).getUI();return r.createElement(c.ToolbarItem,{onClick:()=>e.toggleTab("cell"),enabled:e.isTabActive("cell")},r.createElement(a.FontAwesomeIcon,{icon:o.faMicroscope}))}))},9073:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InfoItem=void 0;const r=n(7294),i=n(2766),s=n(7294),o=n(8099),a=n(7625),l=n(1997),c=n(8421);t.InfoItem=(0,i.observer)((({})=>{const e=(0,s.useContext)(l.SimulationContext).getUI();return r.createElement(c.ToolbarItem,{onClick:()=>e.setInfoOpened(!e.isInfoOpened()),enabled:e.isInfoOpened()},r.createElement(a.FontAwesomeIcon,{icon:o.faInfo}))}))},8421:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarItem=void 0;const r=n(7294),i=n(2766),s=n(8804).default.div`
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 12px;
    gap: 5px;
    min-width: 50px;
    height: 100%;
    ${({focused:e})=>e&&"background: #07090d;"}
    ${({enabled:e,theme:t})=>e&&`background: ${t.primary};`}
    ${({disabled:e})=>e&&"opacity: 0.5; pointer-events: none;"}
    
    &:hover {
        ${({enabled:e})=>!e&&"background: #07090d;"}
    }
`;t.ToolbarItem=(0,i.observer)((e=>r.createElement(s,Object.assign({},e))))},7099:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewSimulationItem=void 0;const r=n(7294),i=n(2766),s=n(7294),o=n(3208),a=n(7625),l=n(1997),c=n(8421);t.NewSimulationItem=(0,i.observer)((({})=>{const e=(0,s.useContext)(l.AppContext);return r.createElement(c.ToolbarItem,{onClick:()=>e.closeSimulation()},r.createElement(a.FontAwesomeIcon,{icon:o.faRotateRight}))}))},7382:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PaintModeItem=void 0;const r=n(7294),i=n(8804),s=n(2766),o=n(7294),a=n(869),l=n(7625),c=n(1997),u=n(8421),h=n(1421),d=n(5912),m=n(1752),g=n(1522),p=n(3540),f=n(9906),y=i.default.div`
    display: flex;
    align-items: center;
    padding: 0 5px;

    &:hover {
        background: rgba(0, 0, 0, 0.3);
    }
`,v=i.default.div`
    margin-left: 5px;
    display: flex;
    align-items: center;
    padding: 0 5px;
`,b=(0,i.default)(u.ToolbarItem)`
    align-items: stretch;
    padding: 0;
    gap: 0;
`,E=[{label:"Square",value:"square"},{label:"Circle",value:"circle"}],O=[{label:"Empty",value:"empty"},{label:"Wall",value:"wall"},{label:"Organic",value:"organic"},{label:"Organism",value:"organism"}];t.PaintModeItem=(0,s.observer)((({})=>{const e=(0,o.useContext)(c.SimulationContext).getRenderer().getPaintMode(),[t,n]=(0,o.useState)(!1),i=(0,o.useRef)();return r.createElement("div",{ref:i},r.createElement(b,{focused:t,enabled:e.isEnabled()},r.createElement(v,{onClick:()=>e.setEnabled(!e.isEnabled())},r.createElement(l.FontAwesomeIcon,{icon:a.faPaintbrush})),r.createElement(y,{onClick:()=>{n(!t),!e.isEnabled()&&e.setEnabled(!0)}},r.createElement(l.FontAwesomeIcon,{icon:h.faCaretDown}))),t&&r.createElement(d.Overflow,{root:i.current,onLoseFocus:()=>n(!1)},r.createElement(m.ContextMenu,null,r.createElement(p.FormRow,{label:"Type of paint"},r.createElement(g.RadioGroup,{choices:O,value:e.getType(),onChange:t=>e.setType(t)})),r.createElement(p.FormRow,{label:"Brush shape"},r.createElement(g.RadioGroup,{choices:E,value:e.getBrush(),onChange:t=>e.setBrush(t)})),r.createElement(f.RangeRow,{label:"Brush size",min:1,max:20,step:1,onChange:t=>e.setSize(t),value:e.getSize()}))))}))},2742:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParametersItem=void 0;const r=n(7294),i=n(2766),s=n(7294),o=n(7810),a=n(7625),l=n(1997),c=n(8421);t.ParametersItem=(0,i.observer)((({})=>{const e=(0,s.useContext)(l.SimulationContext).getUI();return r.createElement(c.ToolbarItem,{onClick:()=>e.toggleTab("parameters"),enabled:e.isTabActive("parameters")},r.createElement(a.FontAwesomeIcon,{icon:o.faCogs}))}))},2384:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderModeItem=void 0;const r=n(7294),i=n(8804),s=n(2766),o=n(7294),a=n(446),l=n(7625),c=n(1997),u=n(8421),h=n(1421),d=n(5912),m=n(1752),g=n(1522),p=i.default.div`
    margin-left: 5px;
`,f=[{label:"Default",value:"default"},{label:"Energy",value:"energy"},{label:"Lifetime",value:"lifetime"},{label:"Genesis",value:"genesis"},{label:"Supply",value:"supply"},{label:"Aggression",value:"attack"},{label:"Movement",value:"step"},{label:"Children count",value:"children"},{label:"Last action",value:"action"}];t.RenderModeItem=(0,s.observer)((({})=>{const e=(0,o.useContext)(c.SimulationContext).getRenderer(),[t,n]=(0,o.useState)(!1),i=(0,o.useRef)();return r.createElement("div",{ref:i},r.createElement(u.ToolbarItem,{focused:t,onClick:()=>n(!t)},r.createElement(l.FontAwesomeIcon,{icon:a.faEye}),r.createElement(p,null,r.createElement(l.FontAwesomeIcon,{icon:h.faCaretDown}))),t&&r.createElement(d.Overflow,{root:i.current,onLoseFocus:()=>n(!1)},r.createElement(m.ContextMenu,null,r.createElement(g.RadioGroup,{choices:f,value:e.getRenderMode(),onChange:t=>{return r=t,e.setRenderMode(r),void n(!1);var r}}))))}))},6700:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartPauseItem=void 0;const r=n(7294),i=n(2766),s=n(7294),o=n(753),a=n(6043),l=n(7625),c=n(1997),u=n(8421);t.StartPauseItem=(0,i.observer)((({})=>{const e=(0,s.useContext)(c.SimulationContext);return e.isPaused()?r.createElement(u.ToolbarItem,{onClick:()=>e.start()},r.createElement(l.FontAwesomeIcon,{icon:o.faPlay})):r.createElement(u.ToolbarItem,{onClick:()=>e.pause()},r.createElement(l.FontAwesomeIcon,{icon:a.faPause}))}))},9008:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StepItem=void 0;const r=n(7294),i=n(2766),s=n(7294),o=n(9596),a=n(7625),l=n(1997),c=n(8421);t.StepItem=(0,i.observer)((({})=>{const e=(0,s.useContext)(l.SimulationContext);return r.createElement(c.ToolbarItem,{disabled:!e.isPaused(),onClick:()=>e.makeStep()},r.createElement(a.FontAwesomeIcon,{icon:o.faForwardStep}))}))},4924:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const r=n(7294),i=n(7294),s=n(2766),o=n(5560),a=n(8804),l=n(1997),c=a.default.div`
    overflow: hidden;
    flex-grow: 1;
`;t.Viewport=(0,s.observer)((({})=>{const e=(0,i.useContext)(l.SimulationContext),t=(0,i.useRef)(),[n,s,a]=(0,o.useSize)();return(0,i.useEffect)((()=>(e.getRenderer().setElement(t.current),()=>{})),[t.current]),(0,i.useEffect)((()=>(e.getRenderer().requestRedraw(),()=>{})),[n,s]),r.createElement(c,{ref:a},r.createElement("canvas",{width:n,height:s,ref:t}))}))},1997:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationContext=t.AppContext=void 0;const r=n(7294);t.AppContext=r.createContext(null),t.SimulationContext=r.createContext(null)},5560:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSize=void 0;const r=n(7294);t.useSize=function(){const[e,t]=(0,r.useState)(0),[n,i]=(0,r.useState)(0),[s,o]=(0,r.useState)(),a=(0,r.useCallback)((e=>{if(e){t(Math.trunc(e.getBoundingClientRect().width)),i(Math.trunc(e.getBoundingClientRect().height));const n=new ResizeObserver((e=>{for(let n of e){t(Math.trunc(n.contentRect.width)),i(Math.trunc(n.contentRect.height));break}}));n.observe(e),o((()=>()=>n.disconnect()))}}),[]);return(0,r.useEffect)((()=>s),[s]),[e,n,a]}},2575:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initMouseInteractions=void 0,t.initMouseInteractions=function(e,t){let n=!1,r=!1;const i=e=>{e.preventDefault(),n=!0,r=!1},s=e=>{e.preventDefault(),r||t.click(e.offsetX,e.offsetY)},o=e=>{e.preventDefault()};let a=0;const l=n=>{if(n.preventDefault(),a+=n.deltaY,Math.abs(a)<40)return;a=0;const[r,i]=t.getOffset(),s=e.getBoundingClientRect(),o=n.clientX-Math.trunc(s.left),l=n.clientY-Math.trunc(s.top),c=(o-r)/t.getScale(),u=(l-i)/t.getScale();n.deltaY<0?t.scaleUp(!1):t.scaleDown(!1),t.setOffset(o-c*t.getScale(),l-u*t.getScale())},c=i=>{if(n)if(r=!0,t.getPaintMode().isEnabled()&&1===i.buttons){const n=e.getBoundingClientRect();t.paint(i.clientX-n.x,i.clientY-n.y)}else{const[e,n]=t.getOffset();t.setOffset(e+i.movementX,n+i.movementY)}},u=()=>{n=!1,r=!1};return e.addEventListener("wheel",l),e.addEventListener("mousedown",i),e.addEventListener("mouseup",s),e.addEventListener("mousemove",o),document.body.addEventListener("mousemove",c),document.body.addEventListener("mouseup",u),()=>{e.removeEventListener("wheel",l),e.removeEventListener("mousedown",i),e.removeEventListener("mouseup",s),e.removeEventListener("mousemove",o),document.body.removeEventListener("mousemove",c),document.body.removeEventListener("mouseup",u)}}},3629:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initTouchInteractions=void 0,t.initTouchInteractions=function(e,t){let n={},r=0,i=!1;const s=()=>2===Object.keys(n).length,o=t=>{const n=e.getBoundingClientRect();return[Math.trunc(t.clientX)-Math.trunc(n.left),Math.trunc(t.clientY)-Math.trunc(n.top)]},a=e=>{e.preventDefault();for(const t of e.changedTouches)s()||(n[t.identifier]=o(t));e.touches.length>1&&(i=!0)},l=e=>{for(const t of e.changedTouches)delete n[t.identifier];i||t.click(...o(e.changedTouches[0])),0===Object.keys(n).length&&(i=!1),r=0},c=e=>{for(const t of e.changedTouches)delete n[t.identifier];0===Object.keys(n).length&&(i=!1),r=0},u=e=>{e.preventDefault(),i=!0;const a=Object.assign({},n),[l,c]=t.getOffset();for(const r of e.changedTouches)n[r.identifier]&&(a[r.identifier]=o(r),1===e.changedTouches.length&&t.getPaintMode().isEnabled()?t.paint(...a[r.identifier]):t.setOffset(l+(a[r.identifier][0]-n[r.identifier][0]),c+(a[r.identifier][1]-n[r.identifier][1])));if(s()){const[e,t]=Object.keys(n),i=Math.abs(Math.hypot(n[e][0]-n[t][0],n[e][1]-n[t][1])),s=Math.abs(Math.hypot(a[e][0]-a[t][0],a[e][1]-a[t][1]));i>s?r-=i-s:r+=s-i}if(Math.abs(r)>=20){const[e,i]=t.getOffset(),[s,o]=Object.keys(n);let a=(n[s][0]+n[o][0])/2,l=(n[s][1]+n[o][1])/2;const c=Math.round((a-e)/t.getScale()),u=Math.round((l-i)/t.getScale());r>0?t.setScale(Math.ceil(1.5*t.getScale()),!1):t.setScale(Math.floor(t.getScale()/1.5),!1),t.setOffset(a-c*t.getScale(),l-u*t.getScale()),r=0}n=a};return e.addEventListener("touchstart",a,{passive:!1}),e.addEventListener("touchend",l),e.addEventListener("touchcancel",c),e.addEventListener("touchmove",u,{passive:!1}),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchend",l),e.removeEventListener("touchcancel",c),e.removeEventListener("touchmove",u)}}},711:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.saveOptions=t.loadOptions=void 0;const r=n(4282);t.loadOptions=function(){return Object.assign({width:200,height:100,loop:r.GridLoopType.NONE,population:5,initialEnergy:70},function(e){let t=localStorage.getItem("evo_simulation_options"),n={};if("string"==typeof t){const e=JSON.parse(t);"object"==typeof e&&(n=e)}return n}())},t.saveOptions=function(e){var t;t=e,localStorage.setItem("evo_simulation_options",JSON.stringify(t))}},9376:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;const i=n(8949),s=n(711),o=n(1548);class a{constructor(){this.simulation=null,(0,i.makeObservable)(this)}newSimulation(e){this.simulation&&this.simulation.terminate(),this.simulation=new o.SimulationStore(e),(0,s.saveOptions)(e)}closeSimulation(){this.simulation&&this.simulation.terminate(),this.simulation=null}getSimulation(){return this.simulation}}r([i.observable],a.prototype,"simulation",void 0),r([i.action],a.prototype,"newSimulation",null),r([i.action],a.prototype,"closeSimulation",null),t.Store=a},4446:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasRenderer=void 0;const s=n(8949),o=n(9408),a=n(8158),l=n(2575),c=n(3629),u=n(7822),h={default:null,energy:"energy",lifetime:"lifetime",supply:"supply",genesis:"genesis",children:"children",attack:"attack",step:"step",action:"action"};class d{constructor(e){this.simulation=e,this.renderMode="default",this.renderTime=0,this.scale=1,this.offset=[0,0],this.canvasDestroyListeners=[],this.needRender=!1,this.rendering=!1,this.renderer=new o.WorkerRenderer,this.paintMode=new u.PaintMode(e,this),(0,s.makeObservable)(this)}setElement(e){this.element&&this.canvasDestroyListeners.forEach((e=>e())),this.element=e,this.context=e.getContext("2d",{alpha:!1}),this.canvasDestroyListeners.push((0,l.initMouseInteractions)(e,this)),this.canvasDestroyListeners.push((0,c.initTouchInteractions)(e,this)),this.fitCenter()}requestRedraw(){if(this.rendering)return void(this.needRender=!0);const e=+Date.now();this.render((t=>{this.redrawId&&cancelAnimationFrame(this.redrawId),this.redrawId=requestAnimationFrame((()=>{this.context.putImageData(t,0,0),(0,s.runInAction)((()=>{this.renderTime=+Date.now()-e})),this.redrawId=null,this.rendering=!1,this.needRender&&(this.needRender=!1,this.requestRedraw())}))}))}setRenderMode(e){this.renderMode=e,this.update(e).then((()=>{}))}update(e=this.renderMode){return i(this,void 0,void 0,(function*(){this.setState(yield this.simulation.getState(h[e])),this.requestRedraw()}))}getRenderMode(){return this.renderMode}getScale(){return this.scale}setScale(e,t=!0){this.scale=e<1?1:e>64?64:Math.round(e),t&&this.requestRedraw()}scaleUp(e=!0){this.setScale(2*this.getScale(),e)}scaleDown(e=!0){this.setScale(this.getScale()/2,e)}getOffset(){return this.offset}setOffset(e,t){this.offset=[Math.round(e),Math.round(t)],this.requestRedraw()}fitCenter(){if(!this.element)return;const e=this.element.width,t=this.element.height,n=this.simulation.getOptions().width,r=this.simulation.getOptions().height,i=n/r,s=e/t,o=i>=s?e:t,a=i>=s?n:r;for(let e=1;e<=64;e++)if(o<e*a){this.scale=1===e?1:e-1;break}this.setOffset(Math.ceil((e-this.scale*n)/2),Math.ceil((t-this.scale*r)/2))}setState(e){this.state=e}terminate(){this.renderer.terminate()}getRenderTime(){return this.renderTime}click(e,t){if(this.paintMode.isEnabled())return void this.paint(e,t);const n=Math.ceil((e-this.offset[0])/this.scale)-1;if(n<0||n>=this.simulation.getOptions().width)return;const r=Math.ceil((t-this.offset[1])/this.scale)-1;r<0||r>=this.simulation.getOptions().height||this.simulation.getSelectedCell().select(n,r)}paint(e,t){this.paintMode.paint(Math.ceil((e-this.offset[0])/this.scale)-1,Math.ceil((t-this.offset[1])/this.scale)-1)}getPaintMode(){return this.paintMode}render(e){this.element&&this.state&&this.element.width&&this.element.height&&h[this.renderMode]===this.state.payload&&(this.rendering=!0,this.renderer.render(e,Math.trunc(this.element.width),Math.trunc(this.element.height),this.offset[0],this.offset[1],this.scale,this.renderMode,new a.Data(new Uint8Array(this.state.buffer.slice(0)),this.state.payload,this.simulation.getOptions().width,this.simulation.getOptions().height)))}}r([s.observable],d.prototype,"renderMode",void 0),r([s.observable],d.prototype,"renderTime",void 0),r([s.action],d.prototype,"setRenderMode",null),t.CanvasRenderer=d},7822:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.PaintMode=void 0;const i=n(8949);class s{constructor(e,t){this.simulation=e,this.canvasRenderer=t,this.enabled=!1,this.type="organic",this.brush="square",this.size=2,this.lastPainted={},(0,i.makeObservable)(this)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}getType(){return this.type}setType(e){this.type=e}getBrush(){return this.brush}setBrush(e){this.brush=e}getSize(){return this.size}setSize(e){this.size=e}paint(e,t){this.clearPaintHistory();const n=this.simulation.getOptions().width,r=this.simulation.getOptions().height,i=this.getSize()-1;let s=[];const o=+Date.now(),a=(e,t)=>{if(e<0||t<0||e>=n||t>=r)return;const i=e+":"+t;this.lastPainted[i]||s.push([e,t]),this.lastPainted[i]=o};if("square"===this.getBrush())for(let n=0;n<1+2*i;n++)for(let r=0;r<1+2*i;r++)a(e-i+n,t-i+r);else if("circle"===this.getBrush()){let n=2*i-3,r=-6,s=4*i-10,o=0,l=i;for(;l>=o;){for(let n=i-o;n<=i+o;n++)a(n+e-i,t+l),a(n+e-i,t-l);for(let n=i-l;n<=i+l;n++)a(n+e-i,t+o),a(n+e-i,t-o);n<0?(n+=s,s-=8,l-=1):(n+=r,s-=4),r-=4,o+=1}}0!==s.length&&this.simulation.replace(s,this.getType()).then((()=>{this.canvasRenderer.update()}))}clearPaintHistory(){const e=+Date.now();for(const t in this.lastPainted)this.lastPainted[t]+1e3<e&&delete this.lastPainted[t]}}r([i.observable],s.prototype,"enabled",void 0),r([i.observable],s.prototype,"type",void 0),r([i.observable],s.prototype,"brush",void 0),r([i.observable],s.prototype,"size",void 0),r([i.action],s.prototype,"setEnabled",null),r([i.action],s.prototype,"setType",null),r([i.action],s.prototype,"setBrush",null),r([i.action],s.prototype,"setSize",null),t.PaintMode=s},2133:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedCell=void 0;const i=n(8949);class s{constructor(e){this.simulation=e,this.coords=null,this.cell=null,this.history=[],this.alive=!0,(0,i.makeObservable)(this)}select(e,t){this.alive=!0,this.coords=[e,t],this.history=[],this.simulation.getCell(e,t).then((e=>{(0,i.runInAction)((()=>{e&&"organism"===e.type?(0,i.runInAction)((()=>{this.cell=e,e.lastAction&&(this.history=[e.lastAction])})):(0,i.runInAction)((()=>{this.cell=null}))})),this.simulation.getUI().setActiveTab("cell")}))}update(){this.cell&&this.alive&&"organism"===this.cell.type&&this.simulation.findCellById(this.cell.id).then((e=>{e&&"organism"===e.type?(0,i.runInAction)((()=>{this.cell=e,this.history.unshift(e.lastAction)})):(0,i.runInAction)((()=>{this.alive=!1}))}))}getCoords(){return this.coords}getCell(){return this.cell}getHistory(){return this.history}isAlive(){return this.alive}}r([i.observable],s.prototype,"coords",void 0),r([i.observable],s.prototype,"cell",void 0),r([i.observable],s.prototype,"history",void 0),r([i.observable],s.prototype,"alive",void 0),r([i.action],s.prototype,"select",null),t.SelectedCell=s},9687:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationParameters=void 0;const i=n(8949);class s{constructor(e){this.store=e,this.organismMaxLifetime=100,this.photosynthesisEnergy=5,this.chemosynthesisEnergy=5,(0,i.makeObservable)(this)}setOrganismMaxLifetime(e){this.store.getSimulation().setParameter("organismMaxLifetime",e).then((e=>{(0,i.runInAction)((()=>{this.organismMaxLifetime=e}))}))}setPhotosynthesisEnergy(e){this.store.getSimulation().setParameter("photosynthesisEnergy",e).then((e=>{(0,i.runInAction)((()=>{this.photosynthesisEnergy=e}))}))}setChemosynthesisEnergy(e){this.store.getSimulation().setParameter("chemosynthesisEnergy",e).then((e=>{(0,i.runInAction)((()=>{this.chemosynthesisEnergy=e}))}))}getOrganismMaxLifetime(){return this.organismMaxLifetime}getPhotosynthesisEnergy(){return this.photosynthesisEnergy}getChemosynthesisEnergy(){return this.chemosynthesisEnergy}}r([i.observable],s.prototype,"organismMaxLifetime",void 0),r([i.observable],s.prototype,"photosynthesisEnergy",void 0),r([i.observable],s.prototype,"chemosynthesisEnergy",void 0),r([i.action],s.prototype,"setOrganismMaxLifetime",null),r([i.action],s.prototype,"setPhotosynthesisEnergy",null),r([i.action],s.prototype,"setChemosynthesisEnergy",null),t.SimulationParameters=s},1548:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationStore=void 0;const s=n(8949),o=n(1563),a=n(4446),l=n(2133),c=n(9687),u=n(789);class h{constructor(e){this.options=e,this.paused=!0,this.ready=!1,this.currentStep=0,this.stepTime=0,this.organismsCount=0,(0,s.makeObservable)(this),this.canvasRenderer=new a.CanvasRenderer(this),this.parameters=new c.SimulationParameters(this),this.ui=new u.SimulationUI,this.selectedCell=new l.SelectedCell(this),(0,o.createSimulation)(e).then((e=>{this.simulation=e,this.canvasRenderer.update().then((()=>{(0,s.runInAction)((()=>this.ready=!0))})),this.simulation.getOrganismsCount().then((e=>{(0,s.runInAction)((()=>{this.organismsCount=e}))}))}))}pause(){this.paused=!0,clearTimeout(this.timeoutId),this.timeoutId=null}start(){if(this.timeoutId)return;this.paused=!1;const e=()=>{this.step().then((()=>{this.canvasRenderer.update().then((()=>{this.paused||(this.timeoutId=setTimeout(e,4))}))}))};this.timeoutId=setTimeout(e,4)}isPaused(){return this.paused}isReady(){return this.ready}makeStep(){this.step().then((()=>{this.canvasRenderer.update()}))}getState(e){return this.simulation.getState(e)}getOptions(){return this.options}getRenderer(){return this.canvasRenderer}terminate(){this.simulation&&this.simulation.terminate(),this.canvasRenderer&&this.canvasRenderer.terminate()}getParameters(){return this.parameters}getSimulation(){return this.simulation}getUI(){return this.ui}getCurrentStep(){return this.currentStep}getStepTime(){return this.stepTime}getOrganismsCount(){return this.organismsCount}getWidth(){return this.simulation.getOptions().width}getHeight(){return this.simulation.getOptions().height}getCell(e,t){return this.simulation.getCell(e,t)}findCellById(e){return this.simulation.findCellById(e)}getSelectedCell(){return this.selectedCell}replace(e,t){return this.simulation.replace(e,t)}step(){return i(this,void 0,void 0,(function*(){const e=Date.now(),t=yield this.simulation.step(),n=yield this.simulation.getOrganismsCount();this.selectedCell.update(),(0,s.runInAction)((()=>{this.stepTime=Date.now()-e,this.currentStep=t,this.organismsCount=n}))}))}}r([s.observable],h.prototype,"paused",void 0),r([s.observable],h.prototype,"ready",void 0),r([s.observable],h.prototype,"currentStep",void 0),r([s.observable],h.prototype,"stepTime",void 0),r([s.observable],h.prototype,"organismsCount",void 0),r([s.action],h.prototype,"pause",null),r([s.action],h.prototype,"start",null),t.SimulationStore=h},789:function(e,t,n){var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationUI=void 0;const i=n(8949);class s{constructor(){this.activeTab=null,this.infoOpened=!1,(0,i.makeObservable)(this)}getActiveTab(){return this.activeTab}isTabActive(e){return this.activeTab===e}toggleTab(e){this.activeTab===e?this.activeTab=null:this.activeTab=e}setActiveTab(e){this.activeTab=e}closeTab(){this.activeTab=null}isInfoOpened(){return this.infoOpened}setInfoOpened(e){this.infoOpened=e}}r([i.observable],s.prototype,"activeTab",void 0),r([i.observable],s.prototype,"infoOpened",void 0),r([i.action],s.prototype,"toggleTab",null),r([i.action],s.prototype,"setActiveTab",null),r([i.action],s.prototype,"closeTab",null),r([i.action],s.prototype,"setInfoOpened",null),t.SimulationUI=s},7698:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalStyle=void 0;const r=n(8804);t.GlobalStyle=r.createGlobalStyle`
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family: monospace;
        font-size: 16px;
    }

    input,
    button,
    select,
    optgroup,
    textarea {
        margin: 0;
        font-family: inherit;
        font-size: inherit;
        line-height: inherit;
    }

    button {
        cursor: pointer;
    }

    canvas {
        display: block;
    }

    * {
        scrollbar-width: auto;
        scrollbar-color: #ffffff transparent;
    }

    *::-webkit-scrollbar {
        width: 8px;
        height: 3px;
    }

    *::-webkit-scrollbar-track {
        background: transparent;
    }

    *::-webkit-scrollbar-thumb {
        background-color: #ffffff;
        border-radius: 10px;
    }
`},23:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.THEME=void 0,t.THEME={background:"#10161e",color:"#f8f2ec",primary:"#0E49B5",success:"#069A8E",secondary:"#393E46"}},9273:(e,t,n)=>{function r(){return new Worker(n.p+"renderer.worker.worker.js")}n.r(t),n.d(t,{default:()=>r})},8365:(e,t,n)=>{function r(){return new Worker(n.p+"simulation.worker.worker.js")}n.r(t),n.d(t,{default:()=>r})}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e].call(s.exports,s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,n,i,s)=>{if(!n){var o=1/0;for(u=0;u<e.length;u++){for(var[n,i,s]=e[u],a=!0,l=0;l<n.length;l++)(!1&s||o>=s)&&Object.keys(r.O).every((e=>r.O[e](n[l])))?n.splice(l--,1):(a=!1,s<o&&(o=s));if(a){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,i,s]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={179:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var i,s,[o,a,l]=n,c=0;if(o.some((t=>0!==e[t]))){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(l)var u=l(r)}for(t&&t(n);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(u)},n=self.webpackChunkevo=self.webpackChunkevo||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=r.O(void 0,[736],(()=>r(2629)));i=r.O(i)})();