(()=>{"use strict";var e={766:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=void 0,t.shuffle=function(e){const t=e;for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}},904:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AssertLessOrEqualThanError=t.AssertLessThanError=t.AssertGreaterOrEqualThanError=t.AssertGreaterThanError=t.AssertIntegerError=t.AssertError=t.assertLessOrEqualThan=t.assertLessThan=t.assertGreaterOrEqualThan=t.assertGreaterThan=t.assertInteger=void 0,t.assertInteger=function(e){if(!Number.isInteger(e))throw new s},t.assertGreaterThan=function(e,t){if(e<=t)throw new n},t.assertGreaterOrEqualThan=function(e,t){if(e<t)throw new i},t.assertLessThan=function(e,t){if(e>=t)throw new o},t.assertLessOrEqualThan=function(e,t){if(e>t)throw new a};class r extends Error{}t.AssertError=r;class s extends r{}t.AssertIntegerError=s;class n extends r{}t.AssertGreaterThanError=n;class i extends r{}t.AssertGreaterOrEqualThanError=i;class o extends r{}t.AssertLessThanError=o;class a extends r{}t.AssertLessOrEqualThanError=a},469:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;const s=r(904),n=r(629);class i{constructor(e,t,r){this.red=e,this.green=t,this.blue=r,e>255?e=255:e<0&&(e=0),t>255?t=255:t<0&&(t=0),r>255?r=255:r<0&&(r=0),(0,s.assertLessOrEqualThan)(e,255),(0,s.assertLessOrEqualThan)(t,255),(0,s.assertLessOrEqualThan)(r,255);const n=e=>1===e.length?"0"+e:e;this.hex="#"+n(this.red.toString(16))+n(this.green.toString(16))+n(this.blue.toString(16))}getRed(){return this.red}getGreen(){return this.green}getBlue(){return this.blue}mix(e,t){return new i(Math.round(this.red*(1-t)+e.getRed()*t),Math.round(this.green*(1-t)+e.getGreen()*t),Math.round(this.blue*(1-t)+e.getBlue()*t))}toHexFormat(){return this.hex}equals(e){return this.blue===e.getBlue()&&this.red===e.getRed()&&this.green===e.getGreen()}toArray(){return[this.red,this.green,this.blue]}static random(){return new i((0,n.randomInt)(0,255),(0,n.randomInt)(0,255),(0,n.randomInt)(0,255))}static fromHex(e){return e.startsWith("#")&&(e=e.slice(1)),new i(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16))}}t.Color=i},629:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomInt=void 0,t.randomInt=function(e,t){const r=t-e+1;return Math.floor(Math.random()*r)+e}},861:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0,t.Connection=class{constructor(e,t,r){this.from=e,this.to=t,this.weight=r}getFrom(){return this.from}getTo(){return this.to}getWeight(){return this.weight}setWeight(e){this.weight=e}getOutput(){return this.from.getOutput()*this.weight}}},310:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IdFactory=void 0,t.IdFactory=class{constructor(){this.id=1}next(){return this.id++}}},837:(e,t)=>{function r(e){return e.getOutput()}Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0,t.Layer=class{constructor(e,t){this.id=e,this.neurons=t}activate(e=null){if(null===e)for(let e of this.neurons)e.activate();else for(let t=0;t<e.length;t++)this.neurons[t].activate(e[t]);return this.neurons.map(r)}getNeurons(){return this.neurons}serialize(){return{id:this.id,neurons:this.neurons.map((e=>e.serialize()))}}}},431:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Network=void 0;const s=r(837),n=r(187);class i{constructor(e,t,r){this.input=e,this.hidden=t,this.output=r}getInputLayer(){return this.input}getHiddenLayers(){return this.hidden}getOutputLayer(){return this.output}activate(e){this.input.activate(e);for(const e of this.hidden)e.activate();return this.output.activate()}serialize(){return{input:this.input.serialize(),hidden:this.hidden.map((e=>e.serialize())),output:this.output.serialize()}}static deserialize(e){const t={},r={},o=e=>e.map((e=>{const s=new n.Neuron(e.id);return t[e.id]=s,r[e.id]=e.connections,s})),a=new s.Layer(e.input.id,o(e.input.neurons)),h=e.hidden.map((e=>new s.Layer(e.id,o(e.neurons)))),c=new s.Layer(e.input.id,o(e.output.neurons));for(let e in t)for(let s of r[e])t[e].connect(t[s[0]],s[1]);return new i(a,h,c)}}t.Network=i},187:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Neuron=void 0;const s=r(861);t.Neuron=class{constructor(e){this.id=e,this.connections=[],this.output=0}getId(){return this.id}connect(e,t){this.connections.push(new s.Connection(e,this,t))}activate(e=null){if(null!==e)this.output=e;else{let e=0;for(let t of this.connections)e+=t.getOutput();this.output=1/(1+Math.pow(Math.E,-e))}return this.output}getOutput(){return this.output}serialize(){return{id:this.id,connections:this.connections.map((e=>[e.getFrom().getId(),e.getWeight()]))}}getConnections(){return this.connections}}},356:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRNN=void 0;const s=r(310),n=r(837),i=r(431),o=r(187);function a(e,t){for(let r of t)for(let t of e)r.connect(t,Math.random())}t.createRNN=function(e,t,r){const h=new s.IdFactory,c=new s.IdFactory,l=[],u=[],g=[];for(let t=0;t<e;t++)u.push(new o.Neuron(h.next()));const d=new n.Layer(c.next(),u);for(let e of t){const t=[];for(let r=0;r<e;r++)t.push(new o.Neuron(h.next()));l.push(new n.Layer(c.next(),t))}for(let e=0;e<r;e++)g.push(new o.Neuron(h.next()));const y=new n.Layer(c.next(),g);return function(e,t,r){let s=e;for(let e of t)a(s.getNeurons(),e.getNeurons()),s=e;a(s.getNeurons(),r.getNeurons())}(d,l,y),function(e){for(const t of e){const e=t.getNeurons();for(let t=0;t<e.length-1;t++)a([e[t]],[e[t+1]]),a([e[t+1]],[e[t]])}}(l),new i.Network(d,l,y)}},40:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractCell=void 0,t.AbstractCell=class{update(e,t){}isStatic(){return!0}isEmpty(){return!1}getId(){return 0}}},591:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellContext=void 0;const s=r(282);class n extends Error{}t.CellContext=class{constructor(e,t,r,s){this.grid=e,this.x=t,this.y=r,this.factory=s}moveByOffest(e,t){try{const r=this.getCoordinatesbyOffset(e,t),s=this.grid.getCell(this.x,this.y);this.grid.getCell(r[0],r[1]).isEmpty()&&(this.grid.delete(this.x,this.y),this.grid.insert(r[0],r[1],s))}catch(e){}}deleteByOffset(e,t){const r=this.getCoordinatesbyOffset(e,t);this.grid.delete(r[0],r[1])}getByOffest(e,t){try{const r=this.getCoordinatesbyOffset(e,t);return this.grid.getCell(r[0],r[1])}catch(e){return this.factory.createWall()}}replace(e){this.grid.delete(this.x,this.y),this.grid.insert(this.x,this.y,e(this.factory))}getCoordinatesbyOffset(e,t){const r=this.grid.getLoopMode(),i=r===s.GridLoopType.TORUS||r===s.GridLoopType.HORIZONTAL,o=r===s.GridLoopType.TORUS||r===s.GridLoopType.VERTICAL,a=this.grid.getWidth(),h=this.grid.getHeight();let c=this.x+e,l=this.y+t;if(i)for(;c<0;)c+=a;else if(c<0||c>a-1)throw new n;if(o)for(;l<0;)l+=h;else if(l<0||l>h-1)throw new n;return[c%a,l%h]}}},240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellFactory=void 0;const s=r(816),n=r(165),i=r(347),o=r(730),a=r(59);t.CellFactory=class{constructor(){this.id=0}create(e){switch(e){case"wall":return this.createWall();case"empty":return this.createEmpty();case"organism":return this.createOrganism(n.Genome.createRandom(),255);case"organic":return this.createOrganic()}throw new Error}createWall(){return this.wall?this.wall:this.wall=new a.WallCell}createEmpty(){return this.empty?this.empty:this.empty=new s.EmptyCell}createOrganism(e,t){return new o.OrganismCell(++this.id,e,t)}createOrganic(){return this.organic?this.organic:this.organic=new i.OrganicCell}}},816:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyCell=void 0;const s=r(40);class n extends s.AbstractCell{getType(){return"empty"}isEmpty(){return!0}serialize(){return{type:"empty"}}}t.EmptyCell=n},347:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrganicCell=void 0;const s=r(40);class n extends s.AbstractCell{getType(){return"organic"}serialize(){return{type:"organic"}}}t.OrganicCell=n},730:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrganismCell=void 0;const s=r(40),n=r(890),i=r(347),o=r(48),a=r(766);class h extends s.AbstractCell{constructor(e,t,r){super(),this.id=e,this.genome=t,this.energy=r,this.lifetime=0,this.energyFromPhotosynthesis=0,this.energyFromChemosynthesis=0,this.energyFromOrganic=0,this.direction=(0,n.randomDirection)()}getId(){return this.id}getType(){return"organism"}getLifetime(){return this.lifetime}getEnergy(){return this.energy}getDirection(){return this.direction}getGenome(){return this.genome}update(e,t){if(0!==t.organismMaxLifetime&&this.lifetime>=t.organismMaxLifetime||this.energy<=0)return void e.replace((e=>e.createOrganic()));const r=(0,n.getOffset)(this.direction),s=e.getByOffest(r[0],r[1]),i=this.genome.getAction(this,s);i===o.OrganismAction.STEP?this.makeStep(e):i===o.OrganismAction.ROTATE_LEFT?this.rotateLeft():i===o.OrganismAction.ROTATE_RIGHT?this.rotateRight():i===o.OrganismAction.DIVIDE?this.divide(e):i===o.OrganismAction.ATTACK?this.attact(e):i===o.OrganismAction.EAT?this.eat(e,t):i===o.OrganismAction.PHOTOSYNTHESIS?this.photosynthesis(t.photosynthesisEnergy):i===o.OrganismAction.CHEMOSYNTHESIS&&this.chemosynthesis(t.chemosynthesisEnergy),this.lastAction=i,this.lifetime++}rotateLeft(){this.direction=(0,n.rotateLeft)(this.direction),this.changeEnergy(-1)}rotateRight(){this.direction=(0,n.rotateRight)(this.direction),this.changeEnergy(-1)}makeStep(e){const t=(0,n.getOffset)(this.direction);e.moveByOffest(t[0],t[1]),this.changeEnergy(-1)}divide(e){this.changeEnergy(-5);for(const t of(0,a.shuffle)(Object.keys(n.Direction))){const r=(0,n.getOffset)(n.Direction[t]);if(e.getByOffest(r[0],r[1]).isEmpty())return e.moveByOffest(r[0],r[1]),this.changeEnergy(Math.floor(this.energy/-2)),void(this.energy>0&&e.replace((e=>e.createOrganism(this.genome.clone(),this.energy))))}this.energy>50?e.replace((e=>e.createOrganism(this.genome.clone(),this.energy))):this.energy=0}attact(e){const t=(0,n.getOffset)(this.direction),r=e.getByOffest(t[0],t[1]);r instanceof h&&r.kill(),this.changeEnergy(-1)}eat(e,t){const r=(0,n.getOffset)(this.direction);e.getByOffest(r[0],r[1])instanceof i.OrganicCell&&(e.deleteByOffset(r[0],r[1]),e.moveByOffest(r[0],r[1]),this.changeEnergy(t.organicEnergy),this.energyFromOrganic+=t.organicEnergy),this.changeEnergy(-1)}photosynthesis(e){this.energyFromPhotosynthesis+=e,this.changeEnergy(e)}chemosynthesis(e){this.energyFromChemosynthesis+=e,this.changeEnergy(e)}changeEnergy(e){this.energy+=e,this.energy>255?this.energy=255:this.energy<0&&(this.energy=0)}kill(){this.energy=0}isStatic(){return!1}isSimilar(e){return this.genome.isSimilar(e.getGenome())}getColor(){return this.genome.getColor()}getEnergyFromOrganic(){return this.energyFromOrganic}getEnergyFromPhotosynthesis(){return this.energyFromPhotosynthesis}getEnergyFromChemosynthesis(){return this.energyFromChemosynthesis}serialize(){return{id:this.id,type:"organism",lifetime:this.lifetime,energy:this.energy,color:this.getColor().toHexFormat(),direction:this.direction.toString(),lastAction:this.lastAction}}}t.OrganismCell=h},48:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomAction=t.OrganismAction=void 0;const s=r(629);var n;!function(e){e.ROTATE_LEFT="ROTATE_LEFT",e.ROTATE_RIGHT="ROTATE_RIGHT",e.STEP="STEP",e.ATTACK="ATTACK",e.EAT="EAT",e.DIVIDE="DIVIDE",e.NOTHING="NOTHING",e.PHOTOSYNTHESIS="PHOTOSYNTHESIS",e.CHEMOSYNTHESIS="CHEMOSYNTHESIS"}(n=t.OrganismAction||(t.OrganismAction={})),t.randomAction=function(){const e=Object.keys(n);return n[e[(0,s.randomInt)(0,e.length-1)]]}},890:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rotateRight=t.rotateLeft=t.randomDirection=t.getOffset=t.Direction=void 0;const s=r(629);var n;!function(e){e.NORTH="NORTH",e.NORTH_EAST="NORTH_EAST",e.NORTH_WEST="NORTH_WEST",e.SOUTH="SOUTH",e.SOUTH_EAST="SOUTH_EAST",e.SOUTH_WEST="SOUTH_WEST",e.EAST="EAST",e.WEST="WEST"}(n=t.Direction||(t.Direction={})),t.getOffset=function(e){switch(e){case n.NORTH:return[0,-1];case n.NORTH_EAST:return[1,-1];case n.NORTH_WEST:return[-1,-1];case n.SOUTH:return[0,1];case n.SOUTH_EAST:return[1,1];case n.SOUTH_WEST:return[-1,1];case n.EAST:return[1,0];case n.WEST:return[-1,0]}},t.randomDirection=function(){return n[Object.keys(n)[(0,s.randomInt)(0,7)]]},t.rotateLeft=function(e){switch(e){case n.NORTH:return n.NORTH_WEST;case n.NORTH_EAST:return n.NORTH;case n.NORTH_WEST:return n.WEST;case n.SOUTH:return n.SOUTH_EAST;case n.SOUTH_EAST:return n.EAST;case n.SOUTH_WEST:return n.SOUTH;case n.EAST:return n.NORTH_EAST;case n.WEST:return n.SOUTH_WEST}},t.rotateRight=function(e){switch(e){case n.NORTH:return n.NORTH_EAST;case n.NORTH_EAST:return n.EAST;case n.NORTH_WEST:return n.NORTH;case n.SOUTH:return n.SOUTH_WEST;case n.SOUTH_EAST:return n.SOUTH;case n.SOUTH_WEST:return n.WEST;case n.EAST:return n.SOUTH_EAST;case n.WEST:return n.NORTH_WEST}}},165:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Genome=void 0;const s=r(347),n=r(48),i=r(730),o=r(59),a=r(431),h=r(356),c=r(629),l=r(469);var u;!function(e){e.EMPTY="EMPTY",e.WALL="WALL",e.ORGANIC="ORGANIC",e.ORGANISM_SIMILAR="ORGANISM_SIMILAR",e.ORGANISM_OTHER="ORGANISM_OTHER"}(u||(u={}));class g{constructor(e,t){this.neuralNetwork=e,this.color=t}getAction(e,t){const r=e.getEnergy()>=60?1:0;let a;a=t instanceof o.WallCell?[1,0,0,0,0,r]:t instanceof s.OrganicCell?[0,1,0,0,0,r]:t instanceof i.OrganismCell?e.isSimilar(t)?[0,0,1,0,0,r]:[0,0,0,1,0,r]:[0,0,0,0,1,r];const h=this.neuralNetwork.activate(a),c=Math.max(...h);switch(h.indexOf(c)){case 0:return n.OrganismAction.STEP;case 1:return n.OrganismAction.PHOTOSYNTHESIS;case 2:return n.OrganismAction.CHEMOSYNTHESIS;case 3:return n.OrganismAction.EAT;case 4:return n.OrganismAction.ATTACK;case 5:return n.OrganismAction.NOTHING;case 6:return n.OrganismAction.ROTATE_RIGHT;case 7:return n.OrganismAction.ROTATE_LEFT;case 8:return n.OrganismAction.DIVIDE}return n.OrganismAction.NOTHING}isSimilar(e){const t=e.getColor();return Math.abs(t.getRed()-this.color.getRed())+Math.abs(t.getGreen()-this.color.getGreen())+Math.abs(t.getBlue()-this.color.getBlue())<30}getColor(){return this.color}clone(){if(10<=(0,c.randomInt)(0,100))return this;const e=a.Network.deserialize(this.neuralNetwork.serialize()),t=e.getHiddenLayers();t.push(e.getInputLayer(),e.getOutputLayer());const r=[];for(const e of t)r.push(...e.getNeurons());const s=[];for(const e of r)s.push(...e.getConnections());const n=s[(0,c.randomInt)(0,s.length-1)];n.setWeight(n.getWeight()+.5*(Math.random()>.5?1:-1));const i=new l.Color(this.color.getRed()+(Math.random()>.5?1:-1)*(0,c.randomInt)(0,5),this.color.getGreen()+(Math.random()>.5?1:-1)*(0,c.randomInt)(0,5),this.color.getBlue()+(Math.random()>.5?1:-1)*(0,c.randomInt)(0,5));return new g(e,i)}static createRandom(){return new g((0,h.createRNN)(6,[9],9),l.Color.random())}}t.Genome=g},59:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WallCell=void 0;const s=r(40);class n extends s.AbstractCell{getType(){return"wall"}serialize(){return{type:"wall"}}}t.WallCell=n},170:function(e,t,r){var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{h(s.next(e))}catch(e){i(e)}}function a(e){try{h(s.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}h((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CommonSimulation=void 0;const n=r(766),i=r(240),o=r(165),a=r(158),h=r(567),c=r(56),l=r(691);class u extends h.Simulation{constructor(e){super(e),e=this.options,this.cellFactory=new i.CellFactory,this.state=new l.State(e.width,e.height,e.loop,new c.SimulationParameters,this.cellFactory);const t=Math.ceil(e.width*e.height*e.population/100);this.spawnOrganisms(t,e.initialEnergy)}step(){return new Promise((e=>{this.state.next(),e(this.state.getStep())}))}getState(e){return new Promise((t=>{const r=a.Data.create(this.state,e);t({step:this.state.getStep(),buffer:r.getArray().buffer,payload:e})}))}setParameter(e,t){return s(this,void 0,void 0,(function*(){return this.state.getParameters()[e]=t,this.state.getParameters()[e]}))}getOrganismsCount(){return s(this,void 0,void 0,(function*(){return this.state.getOrganismsCount()}))}findCellById(e){return s(this,void 0,void 0,(function*(){const t=this.state.getGrid().find(e);return t?t.serialize():null}))}getCell(e,t){return s(this,void 0,void 0,(function*(){return this.state.getGrid().getCell(e,t).serialize()}))}replace(e,t){return s(this,void 0,void 0,(function*(){this.state.replace(e,t)}))}spawnOrganisms(e,t){const r=[],s=this.state.getGrid().toArray();for(let e=0;e<s.length;e++)for(let t=0;t<s[e].length;t++)s[e][t].isEmpty()&&r.push([e,t]);for(const[s,i]of(0,n.shuffle)(r).slice(0,e))this.state.getGrid().insert(s,i,this.cellFactory.createOrganism(o.Genome.createRandom(),t))}}t.CommonSimulation=u},158:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Data=void 0;const s=r(730),n={empty:0,organism:1,organic:2,wall:3},i={direction:1,energy:1,lifetime:1,genesis:3,supply:3},o={NORTH:0,NORTH_EAST:1,NORTH_WEST:2,SOUTH:3,SOUTH_EAST:4,SOUTH_WEST:5,EAST:6,WEST:7};class a{constructor(e,t,r,s){this.array=e,this.payload=t,this.width=r,this.height=s,this.itemLength=this.payload?i[this.payload]+1:1}static create(e,t){const r=e.getGrid(),h=r.getWidth(),c=r.getHeight(),l=t?i[t]:0,u=new Uint8Array(h*c*(l+1));let g=0;for(let e=0;e<h;e++)for(let i=0;i<c;i++){const a=r.getCell(e,i);if(u[g++]=n[a.getType()],a instanceof s.OrganismCell)switch(t){case"direction":u[g]=o[a.getDirection()];break;case"energy":u[g]=a.getEnergy();break;case"lifetime":u[g]=a.getLifetime();break;case"genesis":const e=a.getColor().toArray();u[g]=e[0],u[g+1]=e[1],u[g+2]=e[2];break;case"supply":const t=a.getEnergyFromOrganic(),r=a.getEnergyFromPhotosynthesis(),s=a.getEnergyFromChemosynthesis(),n=Math.max(t,r,s);0===n?(u[g]=255,u[g+1]=255,u[g+2]=255):(u[g]=Math.trunc(255*t/n),u[g+1]=Math.trunc(255*r/n),u[g+2]=Math.trunc(255*s/n))}g+=l}return new a(u,t,h,c)}getArray(){return this.array}getPayload(){return this.payload}getWidth(){return this.width}getHeight(){return this.height}getItemLength(){return this.itemLength}}t.Data=a},928:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Grid=void 0;const s=r(904);t.Grid=class{constructor(e,t,r,n){this.width=e,this.height=t,this.loop=r,this.cellFactory=n,this.cells=[],this.cellIdMap={},(0,s.assertGreaterThan)(e,0),(0,s.assertGreaterThan)(t,0);for(let r=0;r<e;r++){this.cells[r]=[];for(let e=0;e<t;e++)this.cells[r][e]=n.createEmpty()}}insert(e,t,r){(0,s.assertLessThan)(e,this.width),(0,s.assertLessThan)(t,this.height),(0,s.assertGreaterOrEqualThan)(e,0),(0,s.assertGreaterOrEqualThan)(t,0),this.cells[e][t]=r,r.getId()&&(this.cellIdMap[r.getId()]=r)}delete(e,t){const r=this.cells[e][t];this.cells[e][t]=this.cellFactory.createEmpty(),delete this.cellIdMap[r.getId()]}getCell(e,t){return this.cells[e][t]}find(e){return this.cellIdMap[e]}getLoopMode(){return this.loop}getWidth(){return this.width}getHeight(){return this.height}toArray(){return this.cells.map((e=>e.slice()))}serialize(){return this.toArray().map((e=>e.map((e=>e.serialize()))))}}},56:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationParameters=void 0,t.SimulationParameters=class{constructor(e={}){this.organismMaxLifetimeValue=100,this.photosynthesisEnergyValue=5,this.chemosynthesisEnergyValue=5,this.organicEnergyValue=30,null!=e.photosynthesisEnergy&&(this.photosynthesisEnergy=e.photosynthesisEnergy),null!=e.chemosynthesisEnergy&&(this.chemosynthesisEnergy=e.chemosynthesisEnergy),null!=e.organismMaxLifetime&&(this.organismMaxLifetime=e.organismMaxLifetime),null!=e.organicEnergy&&(this.organicEnergy=e.organicEnergy)}set organismMaxLifetime(e){this.organismMaxLifetimeValue=this.converNumberValue(e,!0,1,255)}get organismMaxLifetime(){return this.organismMaxLifetimeValue}set photosynthesisEnergy(e){this.photosynthesisEnergyValue=this.converNumberValue(e,!1,0,255)}get photosynthesisEnergy(){return this.photosynthesisEnergyValue}set chemosynthesisEnergy(e){this.chemosynthesisEnergyValue=this.converNumberValue(e,!1,0,255)}get chemosynthesisEnergy(){return this.chemosynthesisEnergyValue}set organicEnergy(e){this.organicEnergyValue=this.converNumberValue(e,!1,0,255)}get organicEnergy(){return this.organicEnergyValue}serialize(){return{photosynthesisEnergy:this.photosynthesisEnergy,chemosynthesisEnergy:this.chemosynthesisEnergy,organismMaxLifetime:this.organismMaxLifetime,organicEnergy:this.organicEnergy}}converNumberValue(e,t=!0,r=null,s=null){return t&&(e=Math.trunc(e)),null==r&&(e=Math.max(r,e)),null==s&&(e=Math.min(s,e)),e}}},567:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Simulation=t.StepData=void 0,t.StepData=class{constructor(e,t,r){this.step=e,this.buffer=t,this.payload=r}},t.Simulation=class{constructor(e){this.options=e}terminate(){}getOptions(){return this.options}}},691:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const s=r(591),n=r(928);t.State=class{constructor(e,t,r,s,i){this.parameters=s,this.cellFactory=i,this.step=0,this.grid=new n.Grid(e,t,r,i)}next(){const e=this.grid.toArray();for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++){const n=e[t][r];n.isStatic()||n.update(new s.CellContext(this.grid,t,r,this.cellFactory),this.parameters)}this.step++}getGrid(){return this.grid}getStep(){return this.step}getParameters(){return this.parameters}getOrganismsCount(){let e=0;for(let t=0;t<this.grid.getWidth();t++)for(let r=0;r<this.grid.getHeight();r++)"organism"===this.grid.getCell(t,r).getType()&&e++;return e}replace(e,t){for(const[r,s]of e)this.getGrid().insert(r,s,this.cellFactory.create(t))}}},282:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GridLoopType=void 0,(r=t.GridLoopType||(t.GridLoopType={})).NONE="NONE",r.TORUS="TORUS",r.VERTICAL="VERTICAL",r.HORIZONTAL="HORIZONTAL"}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,r),i.exports}(()=>{const e=r(170),t=self;let s;const n={init:r=>{s||(s=new e.CommonSimulation(r.options),t.postMessage({type:"init"}))},step:e=>{s.step().then((r=>{t.postMessage({type:"step",step:r,id:e.id})}))},requestState:e=>{s.getState(e.payload).then((r=>{t.postMessage({id:e.id,type:"state",step:r.step,buffer:r.buffer,payload:r.payload},[r.buffer])}))},setParameter:e=>{s.setParameter(e.parameter,e.value).then((r=>{t.postMessage({id:e.id,type:"setParameter",value:r})}))},getOrganismsCount:e=>{s.getOrganismsCount().then((r=>{t.postMessage({id:e.id,type:"getOrganismsCount",count:r})}))},getCell:e=>{s.getCell(e.x,e.y).then((r=>{t.postMessage({id:e.id,type:"getCell",cell:r})}))},findCellById:e=>{s.findCellById(e.cellId).then((r=>{t.postMessage({id:e.id,type:"findCellById",cell:r})}))},replace:e=>{s.replace(e.coords,e.cellType).then((()=>{t.postMessage({id:e.id,type:"replace"})}))}};t.addEventListener("message",(e=>{n[e.data.type](e.data)}))})()})();